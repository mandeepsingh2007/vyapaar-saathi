import asyncio
import copy
from datetime import date
import logging
import os
import re
from threading import Thread
from multiprocessing import Manager
import json

from apscheduler.schedulers.asyncio import AsyncIOScheduler
from dotenv import load_dotenv
from flask import Flask, request, send_from_directory
from fuzzywuzzy import fuzz
from openai import OpenAI
from twilio.twiml.messaging_response import MessagingResponse
import twilio.rest
import omnidimension

from data_extractor import (
    extract_items_from_bill_image,
    extract_structured_data,
    transcribe_audio,
)
from supabase_client import (
    get_daily_sales_summary,
    get_low_stock_items,
    get_stock_levels,
    get_user_transactions_summary,
    save_transaction,
    supabase,
    update_stock_item,
    get_all_unique_user_ids_with_stock,
)
from weather_events_api import get_weather_forecast, get_festivals_from_llm

# FFmpeg path configuration
ffmpeg_bin_path = r"C:\Users\singh\Downloads\ffmpeg-8.0-essentials_build\ffmpeg-8.0-essentials_build\bin"
if ffmpeg_bin_path not in os.environ["PATH"]:
    os.environ["PATH"] += os.pathsep + ffmpeg_bin_path
    print(f"DEBUG: Added {ffmpeg_bin_path} to PATH for Flask app.")

load_dotenv()

# !! IMPORTANT !!
# Replace this with your actual public URL (e.g., from ngrok or your deployed server)
BASE_URL = "https://6eab3abb0f24.ngrok-free.app"

SHOPKEEPER_LOCATION = {"latitude": 28.7041, "longitude": 77.1025} # Default to Delhi, India
DEFAULT_LANGUAGE = "hi" # Define default language

OMNIDIM_FROM_NUMBER = os.getenv("OMNIDIM_FROM_NUMBER") # OmniDimension 'from' number for outbound calls
OMNIDIM_API_KEY = os.getenv("OMNIDIM_API_KEY")
OMNIDIM_FROM_NUMBER_ID = os.getenv("OMNIDIM_AGENT_ID")

client = OpenAI() # Re-initialize OpenAI client
omnidim_client = omnidimension.Client(OMNIDIM_API_KEY)
# Removed Google Generative AI client configuration
# genai.configure(api_key=os.getenv("GOOGLE_API_KEY"))
# gemini_model = genai.GenerativeModel("gemini-2.5-pro") # Removed Gemini model initialization

app = Flask(__name__)
scheduler = AsyncIOScheduler() # Initialize scheduler here

TWILIO_ACCOUNT_SID = os.getenv("TWILIO_ACCOUNT_SID")
TWILIO_AUTH_TOKEN = os.getenv("TWILIO_AUTH_TOKEN")
TWILIO_WHATSAPP_NUMBER = os.getenv("TWILIO_WHATSAPP_NUMBER")
TWILIO_PHONE_NUMBER = os.getenv("TWILIO_PHONE_NUMBER") # Twilio Voice enabled number
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
OMNIDIM_AGENT_ID = os.getenv("OMNIDIM_AGENT_ID") 
OMNIDIM_AGENT_ID = os.getenv("OMNIDIM_FROM_NUMBER")# OmniDimension Agent ID

twilio_client = twilio.rest.Client(TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN)




# Configure logging
logger = logging.getLogger(__name__)
logging.basicConfig(level=logging.INFO)

language_map = {"en": "en", "english": "en", "hi": "hi", "hindi": "hi",
                "pa": "pa", "punjabi": "pa", "gu": "gu", "gujarati": "gu",
                "ta": "ta", "tamil": "ta", "te": "te", "telugu": "te",
                "bn": "bn", "bengali": "bn", "mr": "mr", "marathi": "mr",
                "ur": "hi", "urdu": "hi"}

MESSAGES = {
    "en": {
        "sale_success": "‚úÖ Sale of ‚Çπ{amount:.2f} recorded for:\n{item_details}",
        "sale_success_no_item": "‚úÖ Sale of ‚Çπ{amount:.2f} added to your records.",
        "expense_success": "‚úÖ Expense of ‚Çπ{amount} ({item}) recorded.",
        "expense_success_no_item": "‚úÖ Expense of ‚Çπ{amount} recorded.",
        "balance_inquiry": "üìä Your current digital khata balance is ‚Çπ{balance:.2f}.\n\nRecent Transactions:\n{transactions_summary}",
        "earnings_summary": "üìà Today's total sales: ‚Çπ{total_sales:.2f}.\n\nToday's transactions:\n{sales_details}",
        "extract_fail": "Could not extract structured data from your message. Please be more specific (e.g., 'Sold 1kg sugar for 50 rupees').",
        "transcribe_fail": "Could not understand your voice note. The audio quality might be poor or not in a supported language.",
        "download_fail": "Failed to download your voice note: {error_msg}. Please try again.",
        "network_error": "A network error occurred while downloading your voice note: {error_msg}. Please try again.",
        "file_error": "There was an issue with the voice note file: {error_msg}. Please try sending it again.",
        "unexpected_error": "An unexpected error occurred while processing your voice note. Please try again.",
        "no_voice_note": "Please send a voice note for transaction processing or a text message for balance inquiry.",
        "unsupported_media": "Unsupported media type: {media_type}. Please send a voice note or an image.",
        "no_transactions_found": "No recent transactions found.",
        "no_sales_found_today": "No sales found today.",
        "image_received_stock_update": "Image received! Processing for stock update...",
        "stock_update_success": "‚úÖ Stock updated successfully for: {updates}.",
        "stock_update_fail": "‚ùå Failed to update stock from image. Error: {error_msg}",
        "file_download_error": "Failed to download your image: {error_msg}. Please try again.",
        "welcome": "Hello! I'm your inventory management bot. How can I help you?",
        "stock_updated": "Stock for {item_name} updated successfully. Current quantity: {current_quantity} {unit}.",
        "sale_recorded": "Sale of {quantity} {unit} of {item_name} recorded. Remaining stock: {current_quantity} {unit}. Total sale amount: {selling_amount}. Profit: {profit}.",
        "purchase_recorded": "Purchase of {quantity} {unit} of {item_name} recorded. New stock: {current_quantity} {unit}. Cost: {cost_price_per_unit} per {unit}.",
        "item_not_found": "'{item_name}' not found in stock. Would you like to add it?",
        "unknown_command": "I didn't understand that. Please try again or type 'help'.",
        "current_stock": "Current stock for {item_name}: {current_quantity} {unit}.",
        "all_stock_items": "Your current stock:\n{stock_list}",
        "daily_summary": "Daily Sales Summary for {date}:\nTotal Sales: {total_sales}\nTotal Profit: {total_profit}\n{sales_details}",
        "low_stock_alert": "‚ö†Ô∏è Low stock alert! The following items are running low:\n{low_stock_items_list}\nPlease consider ordering soon.",
        "call_initiated": "Initiating call to {supplier_name} at {supplier_phone_number} for {quantity} {unit} of {item_name}. I will notify you once the order is confirmed.",
        "order_confirmation_prompt": "Which item and supplier would you like to confirm an order for? Example: 'Order 10 kg rice from Supplier A'.",
        "order_confirmed_shopkeeper": "‚úÖ Order for {quantity} {unit} of {item_name} from {supplier_name} confirmed. Expect delivery in 2 days.",
        "order_failed_shopkeeper": "‚ùå Failed to confirm order for {item_name} from {supplier_name}. Reason: {reason}"
    },
    "hi": {
        "sale_success": "‚úÖ ‚Çπ{amount:.2f} ‡§ï‡•Ä ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¶‡§∞‡•ç‡§ú ‡§ï‡•Ä ‡§ó‡§à:\n{item_details}",
        "sale_success_no_item": "‚úÖ ‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç ‚Çπ{amount:.2f} ‡§ï‡•Ä ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¶‡§∞‡•ç‡§ú ‡§ï‡•Ä ‡§ó‡§à‡•§",
        "expense_success": "‚úÖ ‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç ‚Çπ{amount} ({item}) ‡§ï‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§",
        "expense_success_no_item": "‚úÖ ‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç ‚Çπ{amount} ‡§ï‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§",
        "balance_inquiry": "üìä ‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø ‚Çπ{balance:.2f} ‡§π‡•à‡•§\n\n‡§™‡§ø‡§õ‡§≤‡•á ‡§≤‡•á‡§®‡§¶‡•á‡§®:\n{transactions_summary}",
        "earnings_summary": "üìà ‡§Ü‡§ú ‡§ï‡•Ä ‡§ï‡•Å‡§≤ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä: ‚Çπ{total_sales:.2f}‡•§\n\n‡§Ü‡§ú ‡§ï‡•á ‡§≤‡•á‡§®‡§¶‡•á‡§®:\n{sales_details}",
        "extract_fail": "‡§Ü‡§™‡§ï‡•á ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∏‡•á ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§®‡§ø‡§ï‡§æ‡§≤‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡•Ä‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§ß‡§ø‡§ï ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§∞‡§π‡•á‡§Ç (‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, '50 ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡•á‡§Ç 1 ‡§ï‡§ø‡§≤‡•ã ‡§ö‡•Ä‡§®‡•Ä ‡§¨‡•á‡§ö‡•Ä')‡•§",
        "transcribe_fail": "‡§Ü‡§™‡§ï‡•á ‡§µ‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ ‡§∏‡§ï‡§æ‡•§ ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§ñ‡§∞‡§æ‡§¨ ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à ‡§Ø‡§æ ‡§Ø‡§π ‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ ‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§",
        "download_fail": "‡§Ü‡§™‡§ï‡§æ ‡§µ‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§æ: {error_msg}‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "network_error": "‡§Ü‡§™‡§ï‡§æ ‡§µ‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à: {error_msg}‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "file_error": "‡§µ‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§´‡§º‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§•‡•Ä: {error_msg}‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏‡•á ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§≠‡•á‡§ú‡•á‡§Ç‡•§",
        "unexpected_error": "‡§è‡§ï ‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§∂‡§ø‡§§ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "no_voice_note": "‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§≠‡•á‡§ú‡•á‡§Ç ‡§Ø‡§æ ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø ‡§ú‡§æ‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§Æ‡•à‡§∏‡•á‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",
        "unsupported_media": "‡§Ö‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ ‡§Æ‡•Ä‡§°‡§ø‡§Ø‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞: {media_type}‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§µ‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§Ø‡§æ ‡§è‡§ï ‡§á‡§Æ‡•á‡§ú ‡§≠‡•á‡§ú‡•á‡§Ç‡•§",
        "no_transactions_found": "‡§ï‡•ã‡§à ‡§π‡§æ‡§≤‡§ø‡§Ø‡§æ ‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§",
        "no_sales_found_today": "‡§Ü‡§ú ‡§ï‡•ã‡§à ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¶‡§∞‡•ç‡§ú ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ó‡§à‡•§",
        "image_received_stock_update": "‡§õ‡§µ‡§ø ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•Å‡§à! ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
        "stock_update_success": "‚úÖ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ: {updates}.",
        "stock_update_fail": "‚ùå ‡§õ‡§µ‡§ø ‡§∏‡•á ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤‡•§ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: {error_msg}",
        "file_download_error": "‡§Ü‡§™‡§ï‡•Ä ‡§õ‡§µ‡§ø ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡•Ä: {error_msg}‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "welcome": "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§¨‡•â‡§ü ‡§π‡•Ç‡§Å‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•Ç‡§Å?",
        "stock_updated": "{item_name} ‡§ï‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ: {current_quantity} {unit}.",
        "sale_recorded": "{quantity} {unit} {item_name} ‡§ï‡•Ä ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¶‡§∞‡•ç‡§ú ‡§ï‡•Ä ‡§ó‡§à‡•§ ‡§∂‡•á‡§∑ ‡§∏‡•ç‡§ü‡•â‡§ï: {current_quantity} {unit}. ‡§ï‡•Å‡§≤ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§∞‡§æ‡§∂‡§ø: {selling_amount}. ‡§≤‡§æ‡§≠: {profit}.",
        "purchase_recorded": "{quantity} {unit} {item_name} ‡§ï‡•Ä ‡§ñ‡§∞‡•Ä‡§¶ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡•Ä ‡§ó‡§à‡•§ ‡§®‡§Ø‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï: {current_quantity} {unit}. ‡§≤‡§æ‡§ó‡§§: {cost_price_per_unit} ‡§™‡•ç‡§∞‡§§‡§ø {unit}.",
        "item_not_found": "'{item_name}' ‡§Ü‡§á‡§ü‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á?",
        "unknown_command": "‡§Æ‡•Å‡§ù‡•á ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§Ø‡§æ‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ' ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "current_stock": "{item_name} ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§ü‡•â‡§ï: {current_quantity} {unit}.",
        "all_stock_items": "‡§Ü‡§™‡§ï‡§æ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§ü‡•â‡§ï:\n{stock_list}",
        "daily_summary": "{date} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡•à‡§®‡§ø‡§ï ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂:\n‡§ï‡•Å‡§≤ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä: {total_sales}\n‡§ï‡•Å‡§≤ ‡§≤‡§æ‡§≠: {total_profit}\n{sales_details}",
        "low_stock_alert": "‚ö†Ô∏è ‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä! ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§Æ ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç:\n{low_stock_items_list}\n‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "call_initiated": "‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•à‡§Ç ‡§ó‡•Å‡§™‡•ç‡§§‡§æ ‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§∏‡•á ‡§∞‡§Æ‡§æ ‡§¨‡§æ‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•à‡§Ç {supplier_name} ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•Ç‡§Å?",
        "order_confirmation_prompt": "‡§Ü‡§™ ‡§ï‡§ø‡§∏ ‡§Ü‡§á‡§ü‡§Æ ‡§î‡§∞ ‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á? ‡§â‡§¶‡§æ‡§π‡§∞‡§£: '‡§∏‡§™‡•ç‡§≤‡§æ‡§Ø‡§∞ ‡§è ‡§∏‡•á 10 ‡§ï‡§ø‡§≤‡•ã ‡§ö‡§æ‡§µ‡§≤ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç'‡•§",
        "order_confirmed_shopkeeper": "‚úÖ {item_name} ‡§ï‡•á {quantity} {unit} ‡§ï‡§æ {supplier_name} ‡§∏‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§™‡•Å‡§∑‡•ç‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä 2 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•à‡•§",
        "order_failed_shopkeeper": "‚ùå Failed to confirm order for {item_name} from {supplier_name}. Reason: {reason}"
    },
    "pa": { # Punjabi messages
        "sale_success": "‚úÖ ‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®°‡®ø‡®ú‡©Ä‡®ü‡®≤ ‡®ñ‡®æ‡®§‡©á ‡®µ‡®ø‡©±‡®ö ‚Çπ{amount:.2f} ({item}) ‡®¶‡©Ä ‡®µ‡®ø‡®ï‡®∞‡©Ä ‡®¶‡®∞‡®ú ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à‡•§",
        "sale_success_no_item": "‚úÖ ‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®°‡®ø‡®ú‡©Ä‡®ü‡®≤ ‡®ñ‡®æ‡®§‡©á ‡®µ‡®ø‡©±‡®ö ‚Çπ{amount:.2f} ‡®¶‡©Ä ‡®µ‡®ø‡®ï‡®∞‡©Ä ‡®¶‡®∞‡®ú ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à‡•§",
        "expense_success": "‚úÖ ‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®°‡®ø‡®ú‡©Ä‡®ü‡®≤ ‡®ñ‡®æ‡®§‡©á ‡®µ‡®ø‡©±‡®ö ‚Çπ{amount} ({item}) ‡®¶‡®æ ‡®ñ‡®∞‡®ö ‡®¶‡®∞‡®ú ‡®ï‡©Ä‡®§‡®æ ‡®ó‡®ø‡®Ü‡•§",
        "expense_success_no_item": "‚úÖ ‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®°‡®ø‡®ú‡©Ä‡®ü‡®≤ ‡®ñ‡®æ‡®§‡©á ‡®µ‡®ø‡©±‡®ö ‚Çπ{amount} ‡®¶‡®æ ‡®ñ‡®∞‡®ö ‡®¶‡®∞‡®ú ‡®ï‡©Ä‡®§‡®æ ‡®ó‡®ø‡®Ü‡•§",
        "balance_inquiry": "üìä ‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®°‡®ø‡®ú‡©Ä‡®ü‡®≤ ‡®ñ‡®æ‡®§‡©á ‡®µ‡®ø‡©±‡®ö ‡®µ‡®∞‡®§‡®Æ‡®æ‡®® ‡®¨‡®ï‡®æ‡®á‡®Ü ‚Çπ{balance:.2f} ‡®π‡©à‡•§\n\n‡®™‡®ø‡®õ‡®≤‡©á ‡®≤‡©à‡®£-‡®¶‡©á‡®£:\n{transactions_summary}",
        "extract_fail": "‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®∏‡©Å‡®®‡©á‡®π‡©á ‡®§‡©ã‡®Ç ‡®ú‡®æ‡®£‡®ï‡®æ‡®∞‡©Ä ‡®®‡®π‡©Ä‡®Ç ‡®ï‡©±‡®¢‡©Ä ‡®ú‡®æ ‡®∏‡®ï‡©Ä‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®∏‡®™‡®∏‡®º‡®ü ‡®¨‡©ã‡®≤‡©ã‡•§",
        "transcribe_fail": "‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®µ‡©å‡®á‡®∏ ‡®®‡©ã‡®ü ‡®®‡©Ç‡©∞ ‡®ü‡©ç‡®∞‡®æ‡®Ç‡®∏‡®ï‡©ç‡®∞‡®æ‡®à‡®¨ ‡®ú‡®æ‡®Ç ‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶ ‡®®‡®π‡©Ä‡®Ç ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∏‡®ï‡®ø‡®Ü‡•§ ‡®Ü‡®°‡©Ä‡®ì ‡®ó‡©Å‡®£‡®µ‡©±‡®§‡®æ ‡®ñ‡®∞‡®æ‡®¨ ‡®π‡©ã ‡®∏‡®ï‡®¶‡©Ä ‡®π‡©à‡•§",
        "download_fail": "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®µ‡©å‡®á‡®∏ ‡®®‡©ã‡®ü ‡®°‡®æ‡®ä‡®®‡®≤‡©ã‡®° ‡®®‡®π‡©Ä‡®Ç ‡®π‡©ã ‡®∏‡®ï‡®ø‡®Ü: {error_msg}‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®¶‡©Å‡®¨‡®æ‡®∞‡®æ ‡®ï‡©ã‡®∏‡®º‡®ø‡®∏‡®º ‡®ï‡®∞‡©ã‡•§",
        "network_error": "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®µ‡©å‡®á‡®∏ ‡§®‡•ã‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à: {error_msg}‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "file_error": "‡®µ‡©å‡®á‡®∏ ‡®®‡©ã‡®ü ‡®´‡®æ‡®à‡®≤ ‡®µ‡®ø‡©±‡®ö ‡®∏‡®Æ‡©±‡®∏‡®ø‡®Ü ‡®∏‡©Ä: {error_msg}‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®á‡®∏‡®®‡©Ç‡©∞ ‡®´‡®ø‡®∞ ‡®§‡©ã‡®Ç ‡®≠‡©á‡®ú‡©ã‡•§",
        "unexpected_error": "‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®µ‡©å‡®á‡®∏ ‡®®‡©ã‡®ü ‡®®‡©Ç‡©∞ ‡®™‡©ç‡®∞‡©ã‡®∏‡©à‡®∏ ‡®ï‡®∞‡®¶‡©á ‡®∏‡®Æ‡©á‡®Ç ‡®á‡©±‡®ï ‡®Ö‡®£‡®ï‡®ø‡®Ü‡®∏‡©Ä ‡®ó‡®≤‡®§‡©Ä ‡®π‡©ã‡®à‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®¶‡©Å‡®¨‡®æ‡®∞‡®æ ‡®ï‡©ã‡®∏‡®º‡®ø‡®∏‡®º ‡®ï‡®∞‡©ã‡•§",
        "no_voice_note": "‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®ü‡©ç‡®∞‡®æ‡®Ç‡®ú‡©à‡®ï‡®∏‡®º‡®® ‡®™‡©ç‡®∞‡©ã‡®∏‡©à‡®∏‡®ø‡©∞‡®ó ‡®≤‡®à ‡®á‡©±‡®ï ‡®µ‡©å‡®á‡®∏ ‡®®‡©ã‡®ü ‡®≠‡©á‡®ú‡©ã ‡®ú‡®æ‡®Ç ‡®¨‡®ï‡®æ‡®á‡®Ü ‡®™‡©Å‡©±‡®õ‡®£ ‡®≤‡®à ‡®á‡©±‡®ï ‡®ü‡©à‡®ï‡®∏‡®ü ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®≠‡©á‡®ú‡©ã‡•§",
        "unsupported_media": "‡®Ö‡®∏‡®Æ‡®∞‡®•‡®ø‡®§ ‡®Æ‡©Ä‡®°‡©Ä‡®Ü ‡®ï‡®ø‡®∏‡®Æ: {media_type}‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®á‡©±‡®ï ‡®µ‡©å‡®á‡®∏ ‡®®‡©ã‡®ü ‡®ú‡®æ‡®Ç ‡®á‡©±‡®ï ‡®ö‡®ø‡©±‡®§‡®∞ ‡®≠‡©á‡®ú‡©ã‡•§",
        "no_transactions_found": "‡®ï‡©ã‡®à ‡®π‡®æ‡®≤‡©Ä‡®Ü ‡®≤‡©à‡®£-‡®¶‡©á‡®£ ‡®®‡®π‡©Ä‡®Ç ‡®Æ‡®ø‡®≤‡®ø‡®Ü‡•§",
        "image_received_stock_update": "‡®§‡®∏‡®µ‡©Ä‡®∞ ‡®™‡©ç‡®∞‡®æ‡®™‡®§ ‡®π‡©ã‡®à! ‡®∏‡®ü‡®æ‡®ï ‡®Ö‡©±‡®™‡®°‡©á‡®ü ‡®≤‡®à ‡®™‡©ç‡®∞‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®ï‡©Ä‡®§‡©Ä ‡®ú‡®æ ‡®∞‡®π‡©Ä ‡®π‡©à...",
        "stock_update_success": "‚úÖ ‡®∏‡®ü‡®æ‡®ï ‡®∏‡®´‡®≤‡®§‡®æ‡©ç‡®™‡©Ç‡®∞‡©ç‡®µ‡®ï ‡®Ö‡©±‡®™‡®°‡©á‡®ü ‡®ï‡©Ä‡®§‡®æ ‡®ó‡®ø‡®Ü: {updates}.",
        "stock_update_fail": "‚ùå ‡®§‡®∏‡®µ‡©Ä‡®∞ ‡®§‡©ã‡®Ç ‡®∏‡®ü‡®æ‡®ï ‡®Ö‡©±‡®™‡®°‡©á‡®ü ‡®ï‡®∞‡®® ‡®µ‡®ø‡©±‡®ö ‡®Ö‡®∏‡®´‡®≤‡•§ ‡®ó‡®≤‡®§‡©Ä: {error_msg}",
        "file_download_error": "‡®§‡©Å‡®π‡®æ‡®°‡©Ä ‡®§‡®∏‡®µ‡©Ä‡®∞ ‡®°‡®æ‡®ä‡®®‡®≤‡©ã‡®° ‡®®‡®π‡©Ä‡®Ç ‡§π‡©ã ‡®∏‡®ï‡©Ä: {error_msg}‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®¶‡©Å‡®¨‡®æ‡®∞‡®æ ‡®ï‡©ã‡®∏‡®º‡®ø‡®∏‡®º ‡®ï‡®∞‡©ã‡•§",
        "welcome": "‡®∏‡®§ ‡®∏‡©ç‡®∞‡©Ä ‡®Ö‡®ï‡®æ‡®≤! ‡®Æ‡©à‡®Ç ‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®á‡®®‡®µ‡©à‡®Ç‡®ü‡®∞‡©Ä ‡®™‡©ç‡®∞‡®¨‡©∞‡®ß‡®® ‡®¨‡©ã‡®ü ‡®π‡®æ‡®Ç‡•§ ‡®Æ‡©à‡®Ç ‡®§‡©Å‡®π‡®æ‡®°‡©Ä ‡®ï‡®ø‡µΩ ‡®Æ‡®¶‡®¶ ‡®ï‡®∞ ‡®∏‡®ï‡®¶‡®æ ‡®π‡®æ‡®Ç?",
        "stock_updated": "{item_name} ‡®¶‡®æ ‡®∏‡®ü‡®æ‡®ï ‡®∏‡®´‡®≤‡®§‡®æ‡®™‡©Ç‡®∞‡®µ‡®ï ‡®Ö‡©±‡®™‡®°‡©á‡®ü ‡®ï‡©Ä‡®§‡®æ ‡®ó‡®ø‡®Ü‡•§ ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®Æ‡®æ‡®§‡®∞‡®æ: {current_quantity} {unit}.",
        "sale_recorded": "{quantity} {unit} {item_name} ‡®¶‡©Ä ‡®µ‡®ø‡®ï‡®∞‡©Ä ‡®¶‡®∞‡®ú ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à‡•§ ‡®¨‡®æ‡®ï‡©Ä ‡®∏‡®ü‡®æ‡®ï: {current_quantity} {unit}. ‡®ï‡©Å‡©±‡®≤ ‡®µ‡®ø‡®ï‡®∞‡©Ä ‡®∞‡®æ‡®∏‡®º‡©Ä: {selling_amount}. ‡®≤‡®æ‡®≠: {profit}.",
        "purchase_recorded": "{quantity} {unit} {item_name} ‡®¶‡©Ä ‡®ñ‡®∞‡©Ä‡®¶ ‡®¶‡®∞‡®ú ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à‡•§ ‡®®‡®µ‡´ã ‡®∏‡®ü‡®æ‡®ï: {current_quantity} {unit}. ‡®≤‡®æ‡®ó‡®§: {cost_price_per_unit} ‡®™‡©ç‡®∞‡®§‡©Ä {unit}.",
        "item_not_found": "'{item_name}' ‡®∏‡®ü‡®æ‡®ï ‡®µ‡®ø‡©±‡®ö ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡©Ä. ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á?",
        "unknown_command": "‡®Æ‡©à‡®®‡©Ç‡©∞ ‡®∏‡®Æ‡®ù ‡®®‡®π‡©Ä‡®Ç ‡®Ü‡®á‡®Ü‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ' ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "current_stock": "{item_name} ‡®¶‡®æ ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®ü‡®æ‡®ï: {current_quantity} {unit}.",
        "all_stock_items": "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®ü‡®æ‡®ï:\n{stock_list}",
        "daily_summary": "{date} ‡®≤‡®à ‡®∞‡©ã‡®ú‡®º‡®æ‡®®‡®æ ‡®µ‡®ø‡®ï‡®∞‡©Ä ‡®∏‡©∞‡®ñ‡©á‡®™:\n‡®ï‡©Å‡©±‡®≤ ‡®µ‡®ø‡®ï‡®∞‡©Ä: {total_sales}\n‡®ï‡©Å‡©±‡®≤ ‡®≤‡®æ‡®≠: {total_profit}\n{sales_details}",
        "low_stock_alert": "‚ö†Ô∏è ‡®ò‡©±‡®ü ‡®∏‡®ü‡®æ‡®ï ‡®ö‡©á‡®§‡®æ‡®µ‡®®‡©Ä! ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡©Ä‡®Ü‡®Ç ‡®ö‡©Ä‡®ú‡®º‡®æ‡®Ç ‡®ò‡©±‡®ü ‡®π‡©ã ‡®∞‡®π‡©Ä‡®Ü‡®Ç ‡®π‡®®:\n{low_stock_items_list}\n‡®ú‡®≤‡®¶‡©Ä ‡®π‡©Ä ‡®Ü‡®∞‡®°‡®∞ ‡®ï‡®∞‡®® ‡®¨‡®æ‡®∞‡©á ‡®µ‡®ø‡®ö‡®æ‡®∞ ‡®ï‡®∞‡©ã‡•§",
        "call_initiated": "{item_name} ‡®¶‡©á {quantity} {unit} ‡®≤‡®à {supplier_name} ({supplier_phone_number}) ‡®®‡©Ç‡©∞ ‡®ï‡®æ‡®≤ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∞‡®ø‡®π‡®æ ‡®π‡©à‡•§ ‡®Ü‡®∞‡®°‡®∞ ‡®¶‡©Ä ‡®™‡©Å‡®∏‡®º‡®ü‡©Ä ‡®π‡©ã‡®£ '‡®§‡©á ‡®Æ‡©à‡®Ç ‡®§‡©Å‡®π‡®æ‡®®‡©Ç‡©∞ ‡§∏‡•Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•Ç‡§Ç‡§ó‡§æ‡•§",
        "order_confirmation_prompt": "‡§Ü‡§™ ‡§ï‡§ø‡§∏ ‡§Ü‡§á‡§ü‡§Æ ‡§î‡§∞ ‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á? ‡§â‡§¶‡§æ‡§π‡§∞‡§£: '‡§∏‡§™‡•ç‡§≤‡§æ‡§Ø‡§∞ ‡§è ‡§∏‡•á 10 ‡§ï‡§ø‡§≤‡•ã ‡§ö‡§æ‡§µ‡§≤ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç'‡•§",
        "order_confirmed_shopkeeper": "‚úÖ {item_name} ‡§ï‡•á {quantity} {unit} ‡§ï‡§æ {supplier_name} ‡§∏‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§™‡•Å‡§∑‡•ç‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä 2 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•à‡•§",
        "order_failed_shopkeeper": "‚ùå Failed to confirm order for {item_name} from {supplier_name}. Reason: {reason}"
    },
    "gu": { # Gujarati messages
        "sale_success": "‚úÖ ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™°‡™ø‡™ú‡™ø‡™ü‡™≤ ‡™ñ‡™æ‡™§‡™æ‡™Æ‡™æ‡™Ç ‚Çπ{amount:.2f} ({item}) ‡™®‡´Ä ‡™µ‡´á‡™ö‡™æ‡™£ ‡™®‡´ã‡™Ç‡™ß‡™æ‡™à ‡™õ‡´á.",
        "sale_success_no_item": "‚úÖ ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™°‡™ø‡™ú‡™ø‡™ü‡™≤ ‡™ñ‡™æ‡™§‡™æ‡™Æ‡™æ‡™Ç ‚Çπ{amount:.2f} ‡™®‡´Ä ‡™µ‡´á‡™ö‡™æ‡™£ ‡™®‡´ã‡™Ç‡™ß‡™æ‡™à ‡™õ‡´á.",
        "expense_success": "‚úÖ ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™°‡™ø‡™ú‡™ø‡™ü‡™≤ ‡™ñ‡™æ‡™§‡™æ‡™Æ‡™æ‡™Ç ‚Çπ{amount} ({item}) ‡™®‡´ã ‡™ñ‡™∞‡´ç‡™ö ‡™®‡´ã‡™Ç‡™ß‡™æ‡™Ø‡´ã ‡™õ‡´á.",
        "expense_success_no_item": "‚úÖ ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™°‡™ø‡™ú‡™ø‡™ü‡™≤ ‡™ñ‡™æ‡™§‡™æ‡™Æ‡™æ‡™Ç ‚Çπ{amount} ‡™®‡´ã ‡™ñ‡™∞‡´ç‡™ö ‡™®‡´ã‡™Ç‡™ß‡™æ‡™Ø‡´ã ‡™õ‡´á.",
        "balance_inquiry": "üìä ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™°‡™ø‡™ú‡™ø‡™ü‡™≤ ‡™ñ‡™æ‡™§‡™æ‡™Æ‡™æ‡™Ç ‡™µ‡™∞‡´ç‡™§‡™Æ‡™æ‡™® ‡™¨‡´á‡™≤‡´á‡™®‡´ç‡™∏ ‚Çπ{balance:.2f} ‡™õ‡´á‡•§\n\n‡™õ‡´á‡™≤‡´ç‡™≤‡™æ ‡™µ‡´ç‡™Ø‡™µ‡™π‡™æ‡™∞‡´ã:\n{transactions_summary}",
        "extract_fail": "‡™§‡™Æ‡™æ‡™∞‡™æ ‡™µ‡´â‡™á‡™∏ ‡™®‡´ã‡™ü‡™Æ‡™æ‡™Ç‡™•‡´Ä ‡™Æ‡™æ‡™π‡™ø‡™§‡´Ä ‡™ï‡™æ‡™¢‡´Ä ‡™∂‡™ï‡™æ‡™à ‡™®‡™•‡´Ä. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™∏‡´ç‡™™‡™∑‡´ç‡™ü ‡™¨‡´ã‡™≤‡´ã.",
        "transcribe_fail": "‡™§‡™Æ‡™æ‡™∞‡´ã ‡™µ‡´â‡™á‡™∏ ‡™®‡´ã‡™ü ‡™ü‡´ç‡™∞‡™æ‡™®‡´ç‡™∏‡™ï‡´ç‡™∞‡™æ‡™á‡™¨ ‡™Ö‡™•‡™µ‡™æ ‡™Ö‡™®‡´Å‡™µ‡™æ‡™¶ ‡™ï‡™∞‡´Ä ‡™∂‡™ï‡™æ‡™Ø‡´Å‡™Ç ‡™®‡™•‡´Ä. ‡™ë‡™°‡™ø‡™Ø‡´ã ‡™ó‡´Å‡™£‡™µ‡™§‡´ç‡™§‡™æ ‡™®‡™¨‡™≥‡´Ä ‡™π‡´ã‡™à ‡™∂‡™ï‡´á ‡™õ‡´á.",
        "download_fail": "‡™§‡™Æ‡™æ‡™∞‡´ã ‡™µ‡´â‡™á‡™∏ ‡™®‡´ã‡™ü ‡™°‡™æ‡™â‡™®‡™≤‡´ã‡™° ‡™•‡™à ‡™∂‡™ï‡´ç‡™Ø‡´ã ‡™®‡™•‡´Ä: {error_msg}. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™´‡™∞‡´Ä ‡™™‡´ç‡™∞‡™Ø‡™æ‡™∏ ‡™ï‡™∞‡´ã.",
        "network_error": "‡™§‡™Æ‡™æ‡™∞‡´ã ‡™µ‡´â‡™á‡™∏ ‡™®‡´ã‡™ü ‡™°‡™æ‡™â‡™®‡™≤‡´ã‡™° ‡™ï‡™∞‡™§‡´Ä ‡™µ‡™ñ‡™§‡´á ‡™®‡´á‡™ü‡™µ‡§∞‡´ç‡™ï ‡™≠‡´Ç‡™≤ ‡™•‡™à: {error_msg}. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™´‡™∞‡´Ä ‡™™‡´ç‡™∞‡™Ø‡™æ‡™∏ ‡™ï‡™∞‡´ã.",
        "file_error": "‡™µ‡´â‡™á‡™∏ ‡™®‡´â‡™ü ‡™´‡™æ‡™á‡™≤‡™Æ‡™æ‡™Ç ‡™∏‡™Æ‡®∏‡´ç‡™Ø ‡™π‡™§‡´Ä: {error_msg}‡•§ ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™§‡´á‡™®‡´á ‡™´‡™∞‡´Ä‡™•‡´Ä ‡™Æ‡´ã‡™ï‡™≤‡´ã.",
        "unexpected_error": "‡™§‡™Æ‡™æ‡™∞‡™æ ‡™µ‡´â‡™á‡™∏ ‡™®‡´ã‡™ü ‡™™‡™∞ ‡™™‡´ç‡™∞‡™ï‡´ç‡™∞‡™ø‡™Ø‡™æ ‡™ï‡™∞‡™§‡´Ä ‡™µ‡™ñ‡™§‡´á ‡™Ö‡™£‡´ç‡™ß‡™æ‡™∞‡´Ä ‡™≠‡´Ç‡™≤ ‡™•‡™à. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™´‡™∞‡´Ä ‡™™‡´ç‡™∞‡™Ø‡™æ‡™∏ ‡™ï‡™∞‡´ã.",
        "no_voice_note": "‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™µ‡´ç‡™Ø‡™µ‡™π‡™æ‡™∞ ‡™™‡´ç‡™∞‡™ï‡´ç‡™∞‡™ø‡™Ø‡™æ ‡™Æ‡™æ‡™ü‡´á ‡™µ‡´â‡™á‡™∏ ‡™®‡´ã‡™ü ‡™Æ‡´ã‡™ï‡™≤‡´ã ‡™Ö‡™•‡™µ‡™æ ‡™¨‡´á‡™≤‡´á‡™®‡´ç‡™∏ ‡™™‡´Ç‡™õ‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á ‡™ü‡´á‡™ï‡´ç‡™∏‡´ç‡™ü ‡™∏‡™Ç‡™¶‡´á‡™∂ ‡™Æ‡´ã‡™ï‡™≤‡´ã.",
        "unsupported_media": "‡™Ö‡™∏‡™Æ‡™∞‡´ç‡™•‡™ø‡™§ ‡™Æ‡´Ä‡™°‡™ø‡™Ø‡™æ ‡™™‡´ç‡™∞‡™ï‡™æ‡™∞: {media_type}‡•§ ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™è‡™ï ‡™µ‡´â‡™á‡™∏ ‡™®‡´ã‡™ü ‡™Ö‡™•‡™µ‡™æ ‡™è‡™ï ‡™õ‡™¨‡´Ä ‡™Æ‡´ã‡™ï‡™≤‡´ã‡•§",
        "no_transactions_found": "‡™ï‡´ã‡™à ‡™§‡™æ‡™ú‡´á‡™§‡™∞‡™®‡™æ ‡™µ‡´ç‡™Ø‡™µ‡™π‡™æ‡™∞‡´ã ‡™Æ‡™≥‡´ç‡™Ø‡™æ ‡™®‡™•‡´Ä‡•§",
        "image_received_stock_update": "‡™õ‡™¨‡´Ä ‡™™‡´ç‡™∞‡™æ‡™™‡´ç‡™§ ‡™•‡™à! ‡™∏‡´ç‡™ü‡´ã‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™Æ‡™æ‡™ü‡´á ‡™™‡´ç‡™∞‡™ï‡´ç‡™∞‡™ø‡™Ø‡™æ ‡™•‡™à ‡™∞‡™π‡´Ä ‡™õ‡´á...",
        "stock_update_success": "‚úÖ ‡™∏‡´ç‡™ü‡´ã‡™ï ‡™∏‡™´‡™≥‡™§‡™æ‡´ç‡®™‡©Ç‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™•‡™Ø‡´ã: {updates}.",
        "stock_update_fail": "‚ùå ‡™õ‡™¨‡´Ä‡™Æ‡™æ‡™Ç‡™•‡´Ä ‡™∏‡´ç‡™ü‡´ã‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥. ‡™≠‡´Ç‡™≤: {error_msg}",
        "file_download_error": "‡™§‡™Æ‡™æ‡™∞‡´Ä ‡™õ‡™¨‡´Ä ‡™°‡™æ‡™â‡™®‡™≤‡´ã‡™° ‡™•‡™à ‡™∂‡™ï‡´Ä ‡™®‡™•‡´Ä: {error_msg}. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™´‡™∞‡´Ä ‡™™‡´ç‡™∞‡™Ø‡™æ‡™∏ ‡™ï‡™∞‡´ã.",
        "welcome": "‡™®‡™Æ‡™∏‡´ç‡™§‡´á! ‡™π‡´Å‡™Ç ‡™§‡™Æ‡™æ‡™∞‡´Ä ‡™á‡™®‡´ç‡™µ‡´á‡™®‡´ç‡™ü‡´ç‡™∞‡´Ä ‡™Æ‡´á‡™®‡´á‡™ú‡™Æ‡´á‡™®‡´ç‡™ü ‡™¨‡´ã‡™ü ‡™õ‡´Å‡™Ç. ‡™π‡´Å‡™Ç ‡™§‡™Æ‡™®‡´á ‡™ï‡´á‡™µ‡´Ä ‡™∞‡´Ä‡™§‡´á ‡™Æ‡™¶‡™¶ ‡™ï‡™∞‡´Ä ‡™∂‡™ï‡´Å‡™Ç?",
        "stock_updated": "{item_name} ‡™®‡´ã ‡™∏‡´ç‡™ü‡´ã‡™ï ‡™∏‡´ç‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™•‡™Ø‡´ã. ‡™µ‡™∞‡´ç‡™§‡™Æ‡™æ‡™® ‡™ú‡™•‡´ç‡™•‡´ã: {current_quantity} {unit}.",
        "sale_recorded": "{quantity} {unit} {item_name} ‡™®‡´Å‡™Ç ‡™µ‡´á‡™ö‡™æ‡™£ ‡™®‡´ã‡™Ç‡™ß‡™æ‡™à. ‡™¨‡™æ‡™ï‡´Ä ‡™∏‡´ç‡™ü‡´ã‡™ï: {current_quantity} {unit}. ‡™ï‡´Å‡™≤ ‡™µ‡´á‡™ö‡™æ‡™£ ‡™∞‡™ï‡™Æ: {selling_amount}. ‡™®‡™´‡´ã: {profit}.",
        "purchase_recorded": "{quantity} {unit} {item_name} ‡™®‡´Ä ‡™ñ‡®∞‡´Ä‡™¶‡´Ä ‡™®‡´ã‡™Ç‡™ß‡™æ‡™à. ‡™®‡™µ‡´ã ‡™∏‡´ç‡™ü‡´ã‡™ï: {current_quantity} {unit}. ‡™ñ‡™∞‡´ç‡™ö: {cost_price_per_unit} ‡®™‡©ç‡®∞‡®§‡©Ä {unit}.",
        "item_not_found": "'{item_name}' ‡™∏‡´ç‡™ü‡´ã‡™ï ‡™µ‡®ø‡©±‡®ö ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡©Ä. ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á?",
        "unknown_command": "‡®Æ‡©à‡®®‡©Ç‡©∞ ‡™∏‡®Æ‡™ù ‡™®‡®π‡©Ä‡™Ç ‡®Ü‡™Ø‡™æ. ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ' ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç‡•§",
        "current_stock": "{item_name} ‡™¶‡®æ ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®ü‡®æ‡®ï: {current_quantity} {unit}.",
        "all_stock_items": "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®ü‡®æ‡®ï:\n{stock_list}",
        "daily_summary": "{date} ‡®≤‡®à ‡®∞‡©ã‡®ú‡®º‡®æ‡®®‡®æ ‡®µ‡®ø‡®ï‡®∞‡©Ä ‡®∏‡©∞‡®ñ‡©á‡®™:\n‡®ï‡©Å‡©±‡®≤ ‡®µ‡®ø‡®ï‡®∞‡©Ä: {total_sales}\n‡®ï‡©Å‡©±‡®≤ ‡®≤‡®æ‡®≠: {total_profit}\n{sales_details}",
        "low_stock_alert": "‚ö†Ô∏è ‡®ò‡©±‡®ü ‡®∏‡®ü‡®æ‡®ï ‡®ö‡©á‡®§‡®æ‡®µ‡®®‡©Ä! ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡©Ä‡®Ü‡®Ç ‡®ö‡©Ä‡®ú‡®º‡®æ‡®Ç ‡®ò‡©±‡®ü ‡®π‡©ã ‡®∞‡®π‡©Ä‡®Ü‡®Ç ‡®π‡®®:\n{low_stock_items_list}\n‡®ú‡®≤‡®¶‡©Ä ‡®π‡©Ä ‡®Ü‡®∞‡®°‡®∞ ‡®ï‡®∞‡®® ‡®¨‡®æ‡®∞‡©á ‡®µ‡®ø‡®ö‡®æ‡®∞ ‡®ï‡®∞‡©ã‡•§",
        "call_initiated": "{item_name} ‡™¶‡©á {quantity} {unit} ‡™≤‡®à {supplier_name} ({supplier_phone_number}) ‡™®‡©Ç‡™Ç ‡™ï‡®æ‡™≤ ‡™ï‡©Ä‡™§‡™æ ‡™ú‡™æ ‡™∞‡®ø‡™π‡™æ ‡™π‡©à‡•§ ‡™Ü‡™∞‡®°‡™∞ ‡™¶‡©Ä ‡®™‡©Å‡™∏‡®º‡™ü‡©Ä ‡®π‡©ã‡®£ '‡®§‡©á ‡®Æ‡©à‡®Ç ‡®§‡©Å‡®π‡®æ‡™®‡©Ç‡©∞ ‡§∏‡•Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•Ç‡§Ç‡§ó‡§æ‡•§",
        "order_confirmation_prompt": "‡™§‡™Æ‡´á ‡™ï‡™à ‡™µ‡™∏‡´ç‡™§‡´Å ‡™Ö‡™®‡´á ‡™∏‡™™‡´ç‡™≤‡™æ‡™Ø‡™∞ ‡™Æ‡™æ‡™ü‡´á ‡™ì‡™∞‡´ç‡™°‡™∞ ‡™ï‡™®‡´ç‡™´‡™∞‡´ç‡™Æ ‡™ï‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™Ç‡™ó‡´ã ‡™õ‡´ã? ‡™â‡™¶‡™æ‡™π‡™∞‡™£: '‡™∏‡™™‡´ç‡™≤‡™æ‡™Ø‡™∞ A ‡™™‡™æ‡™∏‡´á‡™•‡´Ä 10 ‡™ï‡™ø‡™≤‡´ã ‡™ö‡´ã‡™ñ‡™æ‡™®‡´ã ‡™ì‡™∞‡´ç‡™°‡™∞ ‡™ï‡™∞‡´ã'.",
        "order_confirmed_shopkeeper": "‚úÖ {item_name} ‡™®‡™æ {quantity} {unit} ‡™Æ‡™æ‡™ü‡´á {supplier_name} ‡™™‡™æ‡™∏‡´á‡™•‡´Ä ‡™ì‡™∞‡´ç‡™°‡™∞ ‡™ï‡™®‡´ç‡™´‡™∞‡´ç‡™Æ ‡™•‡™Ø‡´ã ‡™õ‡´á. ‡™∏‡´ç‡™ü‡´ã‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Ü‡™µ‡´ç‡™Ø‡´ã ‡™õ‡´á. 2 ‡™¶‡™ø‡™µ‡™∏‡™Æ‡™æ‡™Ç ‡™°‡™ø‡™≤‡™ø‡™µ‡™∞‡´Ä ‡™Ö‡™™‡´á‡™ï‡´ç‡™∑‡™ø‡™§ ‡™õ‡´á.",
        "order_failed_shopkeeper": "‚ùå {item_name} ‡™®‡™æ {supplier_name} ‡™™‡™æ‡™∏‡´á‡™•‡´Ä ‡™ì‡™∞‡´ç‡™°‡™∞ ‡™ï‡™®‡´ç‡™´‡™∞‡´ç‡™Æ ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥. ‡™ï‡™æ‡™∞‡™£: {reason}"
    },
    "te": { # Telugu messages
        "sale_success": "‚úÖ ‡∞Æ‡±Ä ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç ‡∞ñ‡∞æ‡∞§‡∞æ‡∞≤‡±ã ‚Çπ{amount:.2f} ({item}) ‡∞Ö‡∞Æ‡±ç‡∞Æ‡∞ï‡∞Ç ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.",
        "sale_success_no_item": "‚úÖ ‡∞Æ‡±Ä ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç ‡∞ñ‡∞æ‡∞§‡∞æ‡∞≤‡±ã ‚Çπ{amount:.2f} ‡∞Ö‡∞Æ‡±ç‡∞Æ‡∞ï‡∞Ç ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.",
        "expense_success": "‚úÖ ‡∞Æ‡±Ä ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç ‡∞ñ‡∞æ‡∞§‡∞æ‡∞≤‡±ã ‚Çπ{amount} ({item}) ‡∞ñ‡∞∞‡±ç‡∞ö‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.",
        "expense_success_no_item": "‚úÖ ‡∞Æ‡±Ä ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç ‡∞ñ‡∞æ‡∞§‡∞æ‡∞≤‡±ã ‚Çπ{amount} ‡∞ñ‡∞∞‡±ç‡∞ö‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.",
        "balance_inquiry": "üìä ‡∞Æ‡±Ä ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç ‡∞ñ‡∞æ‡∞§‡∞æ‡∞≤‡±ã ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞¨‡±ç‡∞Ø‡∞æ‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‚Çπ{balance:.2f} ‡∞â‡∞Ç‡∞¶‡∞ø.\n\n‡∞§‡∞æ‡∞ú‡∞æ ‡∞≤‡∞æ‡∞µ‡∞æ‡∞¶‡±á‡∞µ‡±Ä‡∞≤‡±Å:\n{transactions_summary}",
        "extract_fail": "‡∞Æ‡±Ä ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞°‡±á‡∞ü‡∞æ‡∞®‡±Å ‡∞∏‡±á‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞≤‡±á‡∞Æ‡±Å. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡±ç‡∞™‡∞∑‡±ç‡∞ü‡∞Ç‡∞ó‡∞æ ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞Ç‡∞°‡∞ø.",
        "transcribe_fail": "‡∞Æ‡±Ä ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç‚Äå‡∞®‡±Å ‡∞≤‡∞ø‡∞™‡±ç‡∞Ø‡∞Ç‡∞§‡∞∞‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞Ö‡∞®‡∞®‡±Å‡∞µ‡∞¶‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç ‡∞∏‡∞æ‡∞ß‡∞Ø‡∞Ç ‡∞ï‡∞æ‡∞≤‡±á‡∞¶‡±Å. ‡∞Ü‡∞°‡∞ø‡∞Ø‡±ã ‡∞®‡∞æ‡∞£‡±ç‡∞Ø‡∞§ ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ‡∞ó‡∞æ ‡∞â‡∞Ç‡∞°‡∞µ‡∞ö‡±ç‡∞ö‡±Å.",
        "download_fail": "‡∞Æ‡±Ä ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç‚Äå‡∞®‡±Å ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç‡∞≤‡±ã ‡∞µ‡∞ø‡∞´‡∞≤‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø: {error_msg}. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        "network_error": "‡∞Æ‡±Ä ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç‚Äå‡∞®‡±Å ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞®‡±Ü‡∞ü‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞ï‡±ç ‡∞≤‡±ã‡∞™‡∞Ç ‡∞∏‡∞Ç‡∞≠‡∞µ‡∞ø‡∞Ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø: {error_msg}. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        "file_error": "‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç ‡∞´‡±à‡∞≤‡±ç‚Äå‡∞≤‡±ã ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø ‡∞â‡∞Ç‡∞¶‡∞ø: {error_msg}. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞¶‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡∞Ç‡∞™‡∞Ç‡∞°‡∞ø.",
        "unexpected_error": "‡∞Æ‡±Ä ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç‚Äå‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∏‡±Ü‡∞∏‡±ç ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞ä‡∞π‡∞ø‡∞Ç‡∞ö‡∞®‡∞ø ‡∞≤‡±ã‡∞™‡∞Ç ‡∞∏‡∞Ç‡∞≠‡∞µ‡∞ø‡∞Ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        "no_voice_note": "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞≤‡∞æ‡∞µ‡∞æ‡∞¶‡±á‡∞µ‡±Ä‡∞≤ ‡∞™‡±ç‡∞∞‡∞æ‡∞∏‡±Ü‡∞∏‡∞ø‡∞Ç‡∞ó‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç ‡∞™‡∞Ç‡∞™‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞¨‡±ç‡∞Ø‡∞æ‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞µ‡∞ø‡∞ö‡∞æ‡∞∞‡∞£ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞ü‡±Ü‡∞ï‡±ç‡∞∏‡±ç‡∞ü‡±ç ‡∞∏‡∞Ç‡∞¶‡´á‡∞∂‡∞Ç ‡∞™‡∞Ç‡∞™‡∞Ç‡∞°‡∞ø.",
        "unsupported_media": "‡∞Æ‡∞¶‡±ç‡∞¶‡∞§‡±Å ‡∞≤‡±á‡∞®‡∞ø ‡∞Æ‡±Ä‡∞°‡∞ø‡∞Ø‡∞æ ‡∞∞‡∞ï‡∞Ç: {media_type}‡•§ ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞™‡∞Ç‡∞™‡∞Ç‡∞°‡∞ø.",
        "no_transactions_found": "‡∞§‡∞æ‡∞ú‡∞æ ‡∞≤‡∞æ‡∞µ‡∞æ‡∞¶‡±á‡∞µ‡±Ä‡∞≤‡±Å ‡∞è‡∞µ‡±Ä ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞¨‡∞°‡∞≤‡±á‡∞¶‡±Å.",
        "image_received_stock_update": "‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞∏‡±ç‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø! ‡∞∏‡±ç‡∞ü‡∞æ‡∞ï‡±ç ‡∞Ö‡∞™‡±ç‚Äå‡∞°‡±á‡∞ü‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∏‡±Ü‡∞∏‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...",
        "stock_update_success": "‚úÖ ‡∞∏‡±ç‡∞ü‡∞æ‡∞ï‡±ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞®‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø: {updates}.",
        "stock_update_fail": "‚ùå ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞∏‡±ç‡∞ü‡∞æ‡∞ï‡±ç‚Äå‡∞®‡±Å ‡∞®‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç‡∞≤‡±ã ‡∞µ‡∞ø‡∞´‡∞≤‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø. ‡∞≤‡±ã‡∞™‡∞Ç: {error_msg}",
        "file_download_error": "‡∞Æ‡±Ä ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç‡∞≤‡±ã ‡∞µ‡∞ø‡∞´‡∞≤‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø: {error_msg}. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        "welcome": "‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç! ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡±Ä ‡∞á‡∞®‡±ç‡∞µ‡±Ü‡∞Ç‡∞ü‡∞∞‡±Ä ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞£ ‡∞¨‡∞æ‡∞ü‡±ç ‡∞®‡∞ø. ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞é‡∞≤‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å?",
        "stock_updated": "{item_name} ‡∞®‡∞ø‡∞≤‡±ç‡∞µ ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞®‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞™‡∞∞‡∞ø‡∞Æ‡∞æ‡∞£‡∞Ç: {current_quantity} {unit}.",
        "sale_recorded": "{quantity} {unit} {item_name} ‡∞Ö‡∞Æ‡±ç‡∞Æ‡∞ï‡∞Ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞Æ‡∞ø‡∞ó‡∞ø‡∞≤‡∞ø‡∞® ‡∞®‡∞ø‡∞≤‡±ç‡∞µ: {current_quantity} {unit}. ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞Ö‡∞Æ‡±ç‡∞Æ‡∞ï‡∞™‡±Å ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: {selling_amount}. ‡∞≤‡∞æ‡∞≠‡∞Ç: {profit}.",
        "purchase_recorded": "{quantity} {unit} {item_name} ‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞®‡∞ø‡∞≤‡±ç‡∞µ: {current_quantity} {unit}. ‡∞ß‡∞∞: {cost_price_per_unit} ‡∞™‡±ç‡∞∞‡∞§‡∞ø {unit}.",
        "item_not_found": "'{item_name}' ‡∞®‡∞ø‡∞≤‡±ç‡∞µ‡∞≤‡±ã ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞¨‡∞°‡∞≤‡±á‡∞¶‡±Å. ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞¶‡±Ä‡∞®‡±ç‡∞®‡∞ø ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡∞æ?",
        "unknown_command": "‡∞®‡∞æ‡∞ï‡±Å ‡∞Ö‡∞∞‡±ç‡∞•‡∞Ç ‡∞ï‡∞æ‡∞≤‡±á‡∞¶‡±Å. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≥‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç' ‡∞Ö‡∞®‡∞ø ‡∞ü‡±à‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.",
        "current_stock": "{item_name} ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞®‡∞ø‡∞≤‡±ç‡∞µ: {current_quantity} {unit}.",
        "all_stock_items": "‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞®‡∞ø‡∞≤‡±ç‡∞µ:\n{stock_list}",
        "daily_summary": "{date} ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞∞‡±ã‡∞ú‡±Å‡∞µ‡∞æ‡∞∞‡±Ä ‡∞Ö‡∞Æ‡±ç‡∞Æ‡∞ï‡∞æ‡∞≤ ‡∞∏‡∞æ‡∞∞‡∞æ‡∞Ç‡∞∂‡∞Ç:\n‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞Ö‡∞Æ‡±ç‡∞Æ‡∞ï‡∞æ‡∞≤‡±Å: {total_sales}\n‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞≤‡∞æ‡∞≠‡∞Ç: {total_profit}\n{sales_details}",
        "low_stock_alert": "‚ö†Ô∏è ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞®‡∞ø‡∞≤‡±ç‡∞µ ‡∞π‡±Ü‡∞ö‡±ç‡∞ö‡∞∞‡∞ø‡∞ï! ‡∞ï‡±ç‡∞∞‡∞ø‡∞Ç‡∞¶‡∞ø ‡∞Ö‡∞Ç‡∞∂‡∞æ‡∞≤‡±Å ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ‡∞ó‡∞æ ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø:\n{low_stock_items_list}\n‡∞§‡±ç‡∞µ‡∞∞‡∞≤‡±ã ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞æ‡∞≤‡∞®‡∞ø ‡∞™‡∞∞‡∞ø‡∞ó‡∞£‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        "call_initiated": "{item_name} ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï {quantity} {unit} ‡∞ï‡±ã‡∞∏‡∞Ç {supplier_name} ({supplier_phone_number}) ‡∞ï‡±Å ‡∞ï‡∞æ‡∞≤‡±ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø. ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞® ‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§ ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞§‡±Ü‡∞≤‡∞ø‡∞Ø‡∞ú‡±á‡∞∏‡±ç‡∞§‡∞æ‡∞®‡±Å.",
        "order_confirmation_prompt": "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞è ‡∞µ‡∞∏‡±ç‡∞§‡©Å‡∞µ‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞∏‡∞∞‡∞´‡∞∞‡∞æ‡∞¶‡∞æ‡∞∞‡±Å ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç‚Äå‡∞®‡±Å ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å? ‡∞â‡∞¶‡∞æ‡∞π‡∞∞‡∞£: '‡∞∏‡∞™‡±ç‡∞≤‡∞Ø‡∞∞‡±ç A ‡∞®‡±Å‡∞Ç‡∞°‡∞ø 10 ‡∞ï‡∞ø‡∞≤‡´ã‡∞≤ ‡∞¨‡∞ø‡∞Ø‡±ç‡∞Ø‡∞Ç ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø'.",
        "order_confirmed_shopkeeper": "‚úÖ {item_name} ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï {quantity} {unit} ‡∞ï‡±ä‡∞∞‡∞ï‡±Å {supplier_name} ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞∏‡±ç‡∞ü‡∞æ‡∞ï‡±ç ‡∞Ö‡∞™‡±ç‚Äå‡∞°‡±á‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. 2 ‡∞∞‡±ã‡∞ú‡±Å‡∞≤‡∞≤‡±ã ‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä ‡∞Ü‡∞∂‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.",
        "order_failed_shopkeeper": "‚ùå {item_name} ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï {supplier_name} ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç‚Äå‡∞®‡±Å ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç‡∞≤‡±ã ‡∞µ‡∞ø‡∞´‡∞≤‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø. ‡∞ï‡∞æ‡∞∞‡∞£‡∞Ç: {reason}"
    },
    "bn": { # Bengali messages
        "sale_success": "‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‚Çπ{amount:.2f} ({item}) ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
        "sale_success_no_item": "‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‚Çπ{amount:.2f} ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
        "expense_success": "‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‚Çπ{amount} ({item}) ‡¶ñ‡¶∞‡¶ö ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
        "expense_success_no_item": "‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‚Çπ{amount} ‡¶ñ‡¶∞‡¶ö ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
        "balance_inquiry": "üìä ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‚Çπ{balance:.2f}‡•§\n\n‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®:\n{transactions_summary}",
        "extract_fail": "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßã‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¨‡¶≤‡ßÅ‡¶®‡•§",
        "transcribe_fail": "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßã‡¶ü ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ö‡¶°‡¶ø‡¶ì ‡¶ó‡ßÅ‡¶£‡¶Æ‡¶æ‡¶® ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§",
        "download_fail": "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßã‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø: {error_msg}‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
        "network_error": "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßã‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: {error_msg}‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
        "file_error": "‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßã‡¶ü ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶õ‡¶ø‡¶≤: {error_msg}‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§",
        "unexpected_error": "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶∂‡¶ø‡¶§ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
        "no_voice_note": "‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶ï‡¶∞‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßã‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡¶æ‡¶†‡ßç‡¶Ø ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§",
        "unsupported_media": "‡¶Ö‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶ø‡¶§ ‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞: {media_type}‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßã‡¶ü ‡¶¨‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§",
        "no_transactions_found": "‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§",
        "image_received_stock_update": "‡¶õ‡¶¨‡¶ø ‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
        "stock_update_success": "‚úÖ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: {updates}.",
        "stock_update_fail": "‚ùå ‡¶õ‡¶¨‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: {error_msg}",
        "file_download_error": "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø: {error_msg}‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
        "low_stock_alert": "‚ö†Ô∏è ‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ! ‡¶®‡¶ø‡¶Æ‡ßç‡¶®‡¶≤‡¶ø‡¶ñ‡¶ø‡¶§ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶ï‡¶Æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá:\n{low_stock_items_list}\n‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡¶•‡¶æ ‡¶≠‡¶æ‡¶¨‡ßÅ‡¶®‡•§",
        "welcome": "‡¶®‡¶Æ‡¶∏‡ßç‡¶ï‡¶æ‡¶∞! ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ü‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø?",
        "stock_updated": "{item_name} ‡¶è‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: {current_quantity} {unit}.",
        "sale_recorded": "{quantity} {unit} {item_name} ‡¶è‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡¶ï: {current_quantity} {unit}. ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: {selling_amount}. ‡¶≤‡¶æ‡¶≠: {profit}.",
        "purchase_recorded": "{quantity} {unit} {item_name} ‡¶è‡¶∞ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï: {current_quantity} {unit}. ‡¶ñ‡¶∞‡¶ö: {cost_price_per_unit} ‡¶™‡ßç‡¶∞‡¶§‡¶ø {unit}.",
        "item_not_found": "'{item_name}' ‡¶∏‡ßç‡¶ü‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶ü‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?",
        "unknown_command": "‡¶Ü‡¶Æ‡¶ø ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡¶®‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ '‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø' ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
        "current_stock": "{item_name} ‡¶è‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï: {current_quantity} {unit}.",
        "all_stock_items": "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï:\n{stock_list}",
        "daily_summary": "{date} ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂:\n‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º: {total_sales}\n‡¶Æ‡ßã‡¶ü ‡¶≤‡¶æ‡¶≠: {total_profit}\n{sales_details}",
       
        "call_initiated": "{item_name} ‡¶è‡¶∞ {quantity} {unit} ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø {supplier_name} ({supplier_phone_number}) ‡¶ï‡ßá ‡¶ï‡¶≤ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶æ‡¶¨‡ßã‡•§",
        "order_confirmation_prompt": "‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßã‡¶® ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: '‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶è ‡¶•‡ßá‡¶ï‡ßá 10 ‡¶ï‡ßá‡¶ú‡¶ø ‡¶ö‡¶æ‡¶≤ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®'.",
        "order_confirmed_shopkeeper": "‚úÖ {item_name} ‡¶è‡¶∞ {quantity} {unit} ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø {supplier_name} ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ 2 ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶Ü‡¶∂‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§",
        "order_failed_shopkeeper": "‚ùå {item_name} ‡¶è‡¶∞ {supplier_name} ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶ï‡¶æ‡¶∞‡¶£: {reason}"
    },
    "mr": { # Marathi messages
        "sale_success": "‚úÖ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•ç‡§Ø‡§æ‡§§ ‚Çπ{amount:.2f} ({item}) ‡§ö‡•Ä ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡•Ä ‡§ó‡•á‡§≤‡•Ä ‡§Ü‡§π‡•á.",
        "sale_success_no_item": "‚úÖ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•ç‡§Ø‡§æ‡§§ ‚Çπ{amount:.2f} ‡§ö‡•Ä ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡•Ä ‡§ó‡•á‡§≤‡•Ä ‡§Ü‡§π‡•á.",
        "expense_success": "‚úÖ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•ç‡§Ø‡§æ‡§§ ‚Çπ{amount} ({item}) ‡§ö‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡§æ ‡§ó‡•á‡§≤‡§æ ‡§Ü‡§π‡•á.",
        "expense_success_no_item": "‚úÖ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•ç‡§Ø‡§æ‡§§ ‚Çπ{amount} ‡§ö‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡§æ ‡§ó‡•á‡§≤‡§æ ‡§Ü‡§π‡•á.",
        "balance_inquiry": "üìä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡§æ‡§§‡•ç‡§Ø‡§æ‡§§‡•Ä‡§≤ ‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï ‚Çπ{balance:.2f} ‡§Ü‡§π‡•á.\n\n‡§Ö‡§≤‡•Ä‡§ï‡§°‡•Ä‡§≤ ‡§µ‡•ç‡§Ø‡§µ‡§π‡§æ‡§∞:\n{transactions_summary}",
        "extract_fail": "‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§®‡•ã‡§ü‡§Æ‡§ß‡•Ç‡§® ‡§°‡•á‡§ü‡§æ ‡§ï‡§æ‡§¢‡§§‡§æ ‡§Ü‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§¨‡•ã‡§≤‡§æ.",
        "transcribe_fail": "‡§§‡•Å‡§Æ‡§ö‡§æ ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§ï‡•ç‡§∞‡§æ‡§á‡§¨ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§Ü‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä. ‡§ë‡§°‡§ø‡§ì ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§ñ‡§∞‡§æ‡§¨ ‡§Ö‡§∏‡•Ç ‡§∂‡§ï‡§§‡•á.",
        "download_fail": "‡§§‡•Å‡§Æ‡§ö‡•á ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä: {error_msg}. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.",
        "network_error": "‡§§‡•Å‡§Æ‡§ö‡•á ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§§‡§æ‡§®‡§æ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§Ü‡§≤‡•Ä: {error_msg}. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.",
        "file_error": "‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§´‡§æ‡§á‡§≤‡•ç‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•ã‡§§‡•Ä: {error_msg}. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§§‡•Ä ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡§æ‡§†‡§µ‡§æ.",
        "unexpected_error": "‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§®‡•ã‡§ü‡§µ‡§∞ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡§∞‡§§‡§æ‡§®‡§æ ‡§Ö‡§®‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§Ü‡§≤‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.",
        "no_voice_note": "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§π‡§æ‡§∞‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡•á‡§∏‡§æ‡§†‡•Ä ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§™‡§æ‡§†‡§µ‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï ‡§ö‡•å‡§ï‡§∂‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§Æ‡§ú‡§ï‡•Ç‡§∞ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§™‡§æ‡§†‡§µ‡§æ.",
        "unsupported_media": "‡§Ö‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ ‡§Æ‡•Ä‡§°‡§ø‡§Ø‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞: {media_type}. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§®‡•ã‡§ü ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§á‡§Æ‡•á‡§ú ‡§™‡§æ‡§†‡§µ‡§æ.",
        "no_transactions_found": "‡§Ö‡§≤‡•Ä‡§ï‡§°‡•Ä‡§≤ ‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§π‡§æ‡§∞ ‡§Ü‡§¢‡§≥‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§.",
        "image_received_stock_update": "‡§á‡§Æ‡•á‡§ú ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ù‡§æ‡§≤‡•Ä! ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§¶‡•ç‡§Ø‡§Ø‡§æ‡§µ‡§§ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∏‡•Å‡§∞‡•Ç ‡§Ü‡§π‡•á...",
        "stock_update_success": "‚úÖ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§Ö‡§¶‡•ç‡§Ø‡§Ø‡§æ‡§µ‡§ø‡§§ ‡§ù‡§æ‡§≤‡§æ: {updates}.",
        "stock_update_fail": "‚ùå ‡§á‡§Æ‡•á‡§ú‡§Æ‡§ß‡•Ç‡§® ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§¶‡•ç‡§Ø‡§Ø‡§æ‡§µ‡§ø‡§§ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä. ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä: {error_msg}",
        "file_download_error": "‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§á‡§Æ‡•á‡§ú ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä: {error_msg}. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.",
        "low_stock_alert": "‚ö†Ô∏è ‡§ï‡§Æ‡•Ä ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§≤‡§∞‡•ç‡§ü! ‡§ñ‡§æ‡§≤‡•Ä‡§≤ ‡§µ‡§∏‡•ç‡§§‡•Ç ‡§ï‡§Æ‡•Ä ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á‡§§:\n{low_stock_items_list}\n‡§≤‡§µ‡§ï‡§∞‡§ö ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡§æ‡•§",
        "welcome": "‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞! ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§á‡§®‡•ç‡§µ‡•ç‡§π‡•á‡§Ç‡§ü‡§∞‡•Ä ‡§Æ‡•Ö‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü ‡§¨‡•â‡§ü ‡§Ü‡§π‡•á. ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ï‡§∂‡•Ä ‡§Æ‡§¶‡§§ ‡§ï‡§∞‡•Ç ‡§∂‡§ï‡§§‡•ã?",
        "stock_updated": "{item_name} ‡§ö‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§Ö‡§¶‡•ç‡§Ø‡§Ø‡§æ‡§µ‡§ø‡§§ ‡§ù‡§æ‡§≤‡§æ. ‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ: {current_quantity} {unit}.",
        "sale_recorded": "{quantity} {unit} {item_name} ‡§ö‡•Ä ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡•Ä ‡§ó‡•á‡§≤‡•Ä. ‡§â‡§∞‡•ç‡§µ‡§∞‡§ø‡§§ ‡§∏‡•ç‡§ü‡•â‡§ï: {current_quantity} {unit}. ‡§è‡§ï‡•Ç‡§£ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§∞‡§ï‡•ç‡§ï‡§Æ: {selling_amount}. ‡§®‡§´‡§æ: {profit}.",
        "purchase_recorded": "{quantity} {unit} {item_name} ‡§ö‡•Ä ‡§ñ‡§∞‡•á‡§¶‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡•Ä ‡§ó‡•á‡§≤‡•Ä. ‡§®‡§µ‡•Ä‡§® ‡§∏‡•ç‡§ü‡•â‡§ï: {current_quantity} {unit}. ‡§ï‡§ø‡§Ç‡§Æ‡§§: {cost_price_per_unit} ‡§™‡•ç‡§∞‡§§‡§ø {unit}.",
        "item_not_found": "'{item_name}' ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ü‡§¢‡§≥‡§≤‡•á ‡§®‡§æ‡§π‡•Ä. ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§§‡•á ‡§ú‡•ã‡§°‡•Ç ‡§á‡§ö‡•ç‡§õ‡§ø‡§§‡§æ ‡§ï‡§æ?",
        "unknown_command": "‡§Æ‡§≤‡§æ ‡§∏‡§Æ‡§ú‡§≤‡•á ‡§®‡§æ‡§π‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ '‡§Æ‡§¶‡§§' ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§æ.",
        "current_stock": "{item_name} ‡§ö‡§æ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§ü‡•â‡§ï: {current_quantity} {unit}.",
        "all_stock_items": "‡§§‡•Å‡§Æ‡§ö‡§æ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§ü‡•â‡§ï:\n{stock_list}",
        "daily_summary": "{date} ‡§∏‡§æ‡§†‡•Ä ‡§¶‡•à‡§®‡§ø‡§ï ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂:\n‡§è‡§ï‡•Ç‡§£ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä: {total_sales}\n‡§è‡§ï‡•Ç‡§£ ‡§®‡§´‡§æ: {total_profit}\n{sales_details}",
        
        "call_initiated": "{item_name} ‡§ö‡•ç‡§Ø‡§æ {quantity} {unit} ‡§∏‡§æ‡§†‡•Ä {supplier_name} ({supplier_phone_number}) ‡§≤‡§æ ‡§ï‡•â‡§≤ ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡•á‡§≤‡§æ ‡§ú‡§æ‡§§ ‡§Ü‡§π‡•á. ‡§ë‡§∞‡•ç‡§°‡§∞‡§ö‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡•Ä ‡§ù‡§æ‡§≤‡•ç‡§Ø‡§æ‡§µ‡§∞ ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§∏‡•Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§®‡•§",
        "order_confirmation_prompt": "‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ ‡§µ‡§∏‡•ç‡§§‡•Ç ‡§Ü‡§£‡§ø ‡§™‡•Å‡§∞‡§µ‡§†‡§æ‡§¶‡§æ‡§∞‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§æ‡§Ø‡§ö‡§æ ‡§Ü‡§π‡•á? ‡§â‡§¶‡§æ‡§π‡§∞‡§£: '‡§™‡•Å‡§∞‡§µ‡§†‡§æ‡§¶‡§æ‡§∞ A ‡§ï‡§°‡•Ç‡§® 10 ‡§ï‡§ø‡§≤‡•ã ‡§§‡§æ‡§Ç‡§¶‡•Ç‡§≥ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡§æ'.",
        "order_confirmed_shopkeeper": "‚úÖ {item_name} ‡§ö‡•ç‡§Ø‡§æ {quantity} {unit} ‡§ö‡§æ {supplier_name} ‡§ï‡§°‡•Ç‡§® ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ù‡§æ‡§≤‡§æ ‡§Ü‡§π‡•á. ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§¶‡•ç‡§Ø‡§Ø‡§æ‡§µ‡§ø‡§§ ‡§ù‡§æ‡§≤‡§æ ‡§Ü‡§π‡•á. 2 ‡§¶‡§ø‡§µ‡§∏‡§æ‡§Ç‡§§ ‡§µ‡§ø‡§§‡§∞‡§£ ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§Ü‡§π‡•á.",
        "order_failed_shopkeeper": "‚ùå {item_name} ‡§ö‡•ç‡§Ø‡§æ {supplier_name} ‡§ï‡§°‡•Ç‡§® ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä. ‡§ï‡§æ‡§∞‡§£: {reason}"
    }
}


SUPPLIERS = {
    "Supplier A": {
        "phone": "+919971129359",
        "items": {
            "‡§ö‡§æ‡§µ‡§≤": {"price_per_unit": 45.0, "unit": "kg"},
            "‡§Ü‡§ü‡§æ": {"price_per_unit": 30.0, "unit": "kg"},
            "‡§∏‡•Ç‡§ú‡•Ä": {"price_per_unit": 40.0, "unit": "kg"},
            "‡§∞‡§æ‡§ú‡§Æ‡§æ": {"price_per_unit": 120.0, "unit": "kg"},
            "‡§Æ‡•Ç‡§Ç‡§ó ‡§¶‡§æ‡§≤": {"price_per_unit": 90.0, "unit": "kg"},
            "‡§â‡§°‡§º‡§¶ ‡§¶‡§æ‡§≤": {"price_per_unit": 100.0, "unit": "kg"},
        }
    },
    "Supplier B": {
        "phone": "+919988776655",
        "items": {
            "‡§ö‡§æ‡§µ‡§≤": {"price_per_unit": 47.0, "unit": "kg"},
            "‡§Ü‡§ü‡§æ": {"price_per_unit": 28.0, "unit": "kg"},
            "‡§∏‡•Ç‡§ú‡•Ä": {"price_per_unit": 42.0, "unit": "kg"},
            "‡§∞‡§æ‡§ú‡§Æ‡§æ": {"price_per_unit": 118.0, "unit": "kg"},
            "‡§Æ‡•Ç‡§Ç‡§ó ‡§¶‡§æ‡§≤": {"price_per_unit": 92.0, "unit": "kg"},
            "‡§â‡§°‡§º‡§¶ ‡§¶‡§æ‡§≤": {"price_per_unit": 98.0, "unit": "kg"},
        }
    },
    "Supplier C": {
        "phone": "+917788990011",
        "items": {
            "‡§ö‡§æ‡§µ‡§≤": {"price_per_unit": 46.0, "unit": "kg"},
            "‡§Ü‡§ü‡§æ": {"price_per_unit": 31.0, "unit": "kg"},
            "‡§∏‡•Ç‡§ú‡•Ä": {"price_per_unit": 39.0, "unit": "kg"},
            "‡§∞‡§æ‡§ú‡§Æ‡§æ": {"price_per_unit": 125.0, "unit": "kg"},
            "‡§Æ‡•Ç‡§Ç‡§ó ‡§¶‡§æ‡§≤": {"price_per_unit": 88.0, "unit": "kg"},
            "‡§â‡§°‡§º‡§¶ ‡§¶‡§æ‡§≤": {"price_per_unit": 105.0, "unit": "kg"},
        }
    }
}

class DownloadError(Exception):
    pass

async def find_cheapest_supplier_for_item(item_name: str, item_unit: str) -> dict | None:
    cheapest_supplier = None
    min_price = float('inf')

    # Normalize the item_name and item_unit for better matching
    normalized_item_name = item_name.lower().strip()
    normalized_item_unit = item_unit.lower().strip()

    print(f"DEBUG_SUPPLIER: Searching for cheapest supplier for '{normalized_item_name}' ({normalized_item_unit}).")

    for supplier_name, supplier_info in SUPPLIERS.items():
        for supplier_item_name, item_details in supplier_info["items"].items():
            normalized_supplier_item_name = supplier_item_name.lower().strip()
            supplier_item_unit = item_details["unit"].lower().strip()

            # Use fuzzy matching for item names
            name_score = max(fuzz.token_sort_ratio(normalized_item_name, normalized_supplier_item_name),
                             fuzz.partial_ratio(normalized_item_name, normalized_supplier_item_name))
            
            # Consider a high threshold for fuzzy matching to ensure accuracy
            if name_score >= 80 and normalized_item_unit == supplier_item_unit: # Also ensure units match
                price = item_details["price_per_unit"]
                print(f"DEBUG_SUPPLIER: Found match with {supplier_name} for '{supplier_item_name}' (score: {name_score}). Price: {price} {supplier_item_unit}")

                if price < min_price or (price == min_price and supplier_info["phone"] == "+919971129359"):
                    min_price = price
                    cheapest_supplier = {
                        "supplier_name": supplier_name,
                        "phone": supplier_info["phone"],
                        "item_name": supplier_item_name,
                        "price_per_unit": price,
                        "unit": supplier_item_unit
                    }
    
    if cheapest_supplier:
        print(f"DEBUG_SUPPLIER: Cheapest supplier found: {cheapest_supplier['supplier_name']} for {cheapest_supplier['item_name']} at ‚Çπ{cheapest_supplier['price_per_unit']}/{cheapest_supplier['unit']}")
    else:
        print(f"DEBUG_SUPPLIER: No cheapest supplier found for '{normalized_item_name}' ({normalized_item_unit}).")

    return cheapest_supplier

from tenacity import retry, stop_after_attempt, wait_fixed, retry_if_exception_type
import requests

@retry(stop=stop_after_attempt(3), wait=wait_fixed(2), retry=retry_if_exception_type(DownloadError))
def download_media_with_retry(media_url: str, file_path: str):
    print(f"Attempting to download media from: {media_url}")
    response = requests.get(media_url, auth=(TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN), timeout=10)
    print(f"Download response status code: {response.status_code}")
    response.raise_for_status()

    if not response.content:
        raise DownloadError(f"Downloaded content from {media_url} is empty.")

    with open(file_path, 'wb') as f:
        f.write(response.content)
    print(f"Media downloaded successfully to {file_path}")

async def send_whatsapp_message(to_number: str, message_body: str):
    if to_number == TWILIO_WHATSAPP_NUMBER:
        print(f"DEBUG: Skipping sending message to self ({to_number}). Message: {message_body}")
        return
    try:
        print(f"DEBUG: Attempting to send WhatsApp message to {to_number} from {TWILIO_WHATSAPP_NUMBER}. Message: {message_body}")
        message = await asyncio.to_thread(
            twilio_client.messages.create,
            to=to_number,
            from_=TWILIO_WHATSAPP_NUMBER,
            body=message_body
        )
        print(f"DEBUG: WhatsApp message sent successfully. SID: {message.sid}")
    except Exception as e:
        print(f"ERROR: Failed to send WhatsApp message to {to_number}: {e}")

@app.route("/whatsapp", methods=["POST"])
async def whatsapp_webhook():
    sender_id = request.form.get('From', '')
    message_body = request.form.get('Body', '')
    media_url = request.form.get('MediaUrl0', None)
    media_content_type = request.form.get('MediaContentType0', None)
    current_date = date.today()

    print(f"DEBUG_WEBHOOK: Received message. MediaUrl0: {media_url}, MediaContentType0: {media_content_type}")

    detected_language = 'en'
    original_transcription = ""
    english_translation = ""

    should_return_early = False

    balance_keywords = ["balance", "account", "kitna", "total", "shilak", "rupai", "money", "‡§ñ‡§æ‡§§‡§æ", "‡§ï‡§ø‡§§‡§®‡•á ‡§™‡•à‡§∏‡•á ‡§π‡•à‡§Ç", "how much money", "kitni rakam hai", "‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï", "‡§∞‡§ï‡•ç‡§ï‡§Æ"]
    earnings_keywords = ["kamai", "earnings", "profit", "aaj kii", "today's", "‡§ï‡§ø‡§§‡§®‡•Ä ‡§ï‡§Æ‡§æ‡§à ‡§π‡•Å‡§à", "‡§Ü‡§ú ‡§ï‡•Ä ‡§ï‡§Æ‡§æ‡§à", "‡§´‡§æ‡§Ø‡§¶‡§æ", "‡§ï‡§Æ‡§à", "how much did you earn today", "how much you earn today", "total sales today", "total earned today", "‡§Ü‡§ú ‡§ï‡§Æ‡§à", "‡§ï‡§Æ‡§à", "aaj ki kamai", "how much today earnings"]

    cleaned_original_transcription = ""
    cleaned_english_translation = ""

    if media_url:
        if media_content_type and 'audio' in media_content_type:
            try:
                audio_file_path = f"./temp_audio_{sender_id.replace(':', '_')}.ogg"
                download_media_with_retry(media_url, audio_file_path)

                from pydub import AudioSegment  # Ensure AudioSegment is imported

                mp3_file_path = audio_file_path.replace(".ogg", ".mp3")
                try:
                    AudioSegment.from_file(audio_file_path).export(mp3_file_path, format="mp3")
                except Exception as e:
                    print(f"Error converting audio file: {e}")
                    raise
                finally:
                    if os.path.exists(audio_file_path):
                        os.remove(audio_file_path)

                transcription_result = transcribe_audio(mp3_file_path)
                if os.path.exists(mp3_file_path):
                    os.remove(mp3_file_path)
               

                original_transcription = transcription_result["original_transcription"]
                english_translation = transcription_result["english_translation"]
                detected_language = language_map.get(transcription_result["detected_language"], 'en')
                print(f"Detected language: {detected_language}")
                print(f"Original Transcription: {original_transcription}")
                print(f"English Translation: {english_translation}")

                cleaned_original_transcription = re.sub(r'[^\w\s]', '', original_transcription, flags=re.IGNORECASE | re.UNICODE).lower().strip() if original_transcription else ''
                cleaned_english_translation = re.sub(r'[^\w\s]', '', english_translation, flags=re.IGNORECASE | re.UNICODE).lower().strip() if english_translation else ''

            except Exception as e:
                print(f"Error during voice note processing: {e}")
                reply_message = MESSAGES[detected_language]["file_error"].format(error_msg=str(e))
                await send_whatsapp_message(sender_id, reply_message)
                should_return_early = True
                original_transcription = ""
                english_translation = ""

        elif media_content_type and 'image' in media_content_type:
            try:
                image_file_path = f"./temp_image_{sender_id.replace(':', '_')}.jpg"
                download_media_with_retry(media_url, image_file_path)

                await send_whatsapp_message(sender_id, MESSAGES[detected_language]["image_received_stock_update"])

                extracted_bill_data = extract_items_from_bill_image(image_file_path)
                os.remove(image_file_path)

                bill_type = extracted_bill_data.get("bill_type", "unknown")
                extracted_items = extracted_bill_data.get("items", [])
                detected_language_from_bill = extracted_bill_data.get("detected_language", 'en')

                detected_language = language_map.get(detected_language_from_bill, 'en')
                print(f"DEBUG: Detected language from bill: {detected_language_from_bill} -> Normalized: {detected_language}")

                print(f"DEBUG: Extracted bill type: {bill_type}")
                print(f"DEBUG: Extracted items: {extracted_items}")

                if extracted_items:
                    update_messages = []

                    if bill_type == "unknown":
                        if any(item.get("cost_price_per_unit") is not None for item in extracted_items):
                            bill_type = "purchase"
                        elif any(item.get("selling_price_per_unit") is not None for item in extracted_items):
                            reply_message = MESSAGES[detected_language]["stock_update_fail"].format(error_msg="Sales via image are not supported. Please send sales details (item name, quantity, selling price) via voice note or text.")
                            await send_whatsapp_message(sender_id, reply_message)
                            should_return_early = True

                    if bill_type == "purchase":
                        total_bill_expense = 0.0
                        for item in extracted_items:
                            item_name = item.get("item_name")
                            quantity = item.get("quantity")
                            unit = item.get("unit", "pcs")
                            cost_price_per_unit = item.get("cost_price_per_unit")

                            if item_name and isinstance(quantity, (int, float)) and cost_price_per_unit is not None:
                                print(f"DEBUG: Processing purchase item: {item_name}, quantity={float(quantity)} {unit}, cost_price_per_unit={cost_price_per_unit}")
                                await update_stock_item(sender_id, item_name, float(quantity), unit, cost_price_per_unit)
                                update_messages.append(f"{item_name}: {quantity} {unit}")

                                quantity_for_expense_calc = float(quantity)

                                total_bill_expense += quantity_for_expense_calc * float(cost_price_per_unit)

                        if update_messages:
                            if total_bill_expense > 0:
                                expense_data = {
                                    "date": current_date.strftime('%Y-%m-%d'),
                                    "type": "expense",
                                    "amount": total_bill_expense,
                                    "item": f"Stock purchase via bill ({len(update_messages)} items)"
                                }
                                await save_transaction(expense_data, sender_id)
                                update_messages.append(f"Total expense of ‚Çπ{total_bill_expense:.2f} recorded.")

                            reply_message = MESSAGES[detected_language]["stock_update_success"].format(updates="\n".join(update_messages))
                            await send_whatsapp_message(sender_id, reply_message)
                            should_return_early = True
                        else:
                            reply_message = MESSAGES[detected_language]["stock_update_fail"].format(error_msg="Could not extract any valid items with cost prices from the purchase bill.")
                            await send_whatsapp_message(sender_id, reply_message)
                            should_return_early = True

                    elif bill_type == "sale":
                        reply_message = MESSAGES[detected_language]["stock_update_fail"].format(error_msg="Sales bills cannot be processed via image. Please send sales information via voice note or text (item name, quantity, selling price).")
                        await send_whatsapp_message(sender_id, reply_message)
                        should_return_early = True

                    else:
                        reply_message = MESSAGES[detected_language]["stock_update_fail"].format(error_msg="Could not extract any valid items or clear pricing information from the image to determine bill type.")
                        await send_whatsapp_message(sender_id, reply_message)
                        should_return_early = True

                else:
                    reply_message = MESSAGES[detected_language]["stock_update_fail"].format(error_msg="Could not extract any items from the image.")
                    await send_whatsapp_message(sender_id, reply_message)
                    should_return_early = True

            except Exception as e:
                print(f"Error during image processing: {e}")
                print(f"DEBUG: Type of exception e: {type(e)}")
                print(f"DEBUG: Content of exception e: {e}")
                reply_message = MESSAGES[detected_language]["stock_update_fail"].format(error_msg=str(e))
                await send_whatsapp_message(sender_id, reply_message)
                should_return_early = True
        else:
            print(f"Unsupported media type received: {media_content_type}")
            reply_message = MESSAGES[detected_language]["unsupported_media"].format(media_type=media_content_type)
            await send_whatsapp_message(sender_id, reply_message)
            should_return_early = True

    if should_return_early:
        return str(MessagingResponse())

    if message_body and not should_return_early:
        original_transcription = message_body
        english_translation = message_body
        print(f"Received text message: {message_body}")
        detected_language = 'en'
        cleaned_original_transcription = re.sub(r'[^\w\s]', '', original_transcription, flags=re.IGNORECASE | re.UNICODE).lower().strip() if original_transcription else ''
        cleaned_english_translation = re.sub(r'[^\w\s]', '', english_translation, flags=re.IGNORECASE | re.UNICODE).lower().strip() if english_translation else ''

    if should_return_early:
        return str(MessagingResponse())

    if not should_return_early:
        print(f"DEBUG_APP: should_return_early at start of main processing block: {should_return_early}")

        if detected_language != 'en' and english_translation:
            text_for_extraction = english_translation
            print(f"DEBUG: Using English translation for extraction (prioritized due to non-English detected language): {text_for_extraction}")
        elif original_transcription:
            text_for_extraction = original_transcription
            print(f"DEBUG: Using original transcription for extraction (default or English detected): {text_for_extraction}")
        elif english_translation:
            text_for_extraction = english_translation
            print(f"DEBUG: Using English translation for extraction (fallback): {text_for_extraction}")
        else:
            text_for_extraction = ""
            print("DEBUG: No text available for extraction.")

        is_balance_inquiry = any(keyword in cleaned_original_transcription or keyword in cleaned_english_translation for keyword in balance_keywords)
        is_earnings_inquiry = any(keyword in cleaned_original_transcription or keyword in cleaned_english_translation for keyword in earnings_keywords)

        if is_earnings_inquiry:
            today_sales, today_sales_transactions = await get_daily_sales_summary(sender_id, current_date)

            sales_details_list = []
            if today_sales_transactions:
                for txn in today_sales_transactions:
                    txn_item = txn.get("item", "N/A")
                    txn_amount = f'{txn.get("amount", 0.0):.2f}'
                    sales_details_list.append(f"‚Ä¢ {txn_item}: ‚Çπ{txn_amount}")
                sales_details_str = "\n".join(sales_details_list)
            else:
                sales_details_str = MESSAGES[detected_language].get("no_sales_found_today", "No sales found today.")

            reply_message = MESSAGES[detected_language]["earnings_summary"].format(
                total_sales=today_sales,
                sales_details=sales_details_str
            )
            await send_whatsapp_message(sender_id, reply_message)
            should_return_early = True

        elif is_balance_inquiry:
            total_balance, recent_transactions = await get_user_transactions_summary(sender_id)

            transactions_summary_list = []
            for txn in recent_transactions:
                txn_date = txn.get("transaction_date", "N/A")
                txn_type = txn.get("transaction_type", "N/A").capitalize()
                txn_amount = f'{txn.get("amount", "N/A"):.2f}' if isinstance(txn.get("amount"), (int, float)) else "N/A"
                txn_item = txn.get("item", "")

                formatted_txn_amount = txn_amount
                formatted_txn_date = txn_date

                summary_line = f"‚Ä¢ Date: {formatted_txn_date}, Type: {txn_type}, Amount: ‚Çπ{formatted_txn_amount}"
                if txn_item:
                    summary_line += f" ({txn_item})"
                transactions_summary_list.append(summary_line)

            transactions_summary_str = "\n".join(transactions_summary_list) if transactions_summary_list else MESSAGES[detected_language].get("no_transactions_found", "No recent transactions found.")

            reply_message = MESSAGES[detected_language]["balance_inquiry"].format(
                balance=total_balance,
                transactions_summary=transactions_summary_str
            )

            await send_whatsapp_message(sender_id, reply_message)
            should_return_early = True

        elif (english_translation or original_transcription):
            if detected_language != 'en' and english_translation:
                text_for_extraction = english_translation
                print(f"DEBUG: Using English translation for extraction (prioritized due to non-English detected language): {text_for_extraction}")
            elif original_transcription:
                text_for_extraction = original_transcription
                print(f"DEBUG: Using original transcription for extraction (default or English detected): {text_for_extraction}")
            elif english_translation:
                text_for_extraction = english_translation
                print(f"DEBUG: Using English translation for extraction (fallback): {text_for_extraction}")
            else:
                text_for_extraction = ""
                print("DEBUG: No text available for extraction.")

            if not text_for_extraction:
                print("ERROR_APP: No valid text available for extraction after selection logic.")
                await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])
                should_return_early = True
                return str(MessagingResponse()) # Return early

            print(f"DEBUG: Text for structured data extraction: {text_for_extraction}")
            try:
                raw_extracted_content = extract_structured_data(text_for_extraction, current_date)
                print(f"DEBUG_APP: Raw extracted content (from data_extractor): {raw_extracted_content}")
                extracted_data = copy.deepcopy(raw_extracted_content)
                print(f"DEBUG_APP: Extracted structured data (after direct deep copy): {extracted_data}")
            except Exception as e:
                print(f"ERROR_APP: Exception during data extraction or type checking: {e}")
                print(f"ERROR_APP: Type of exception: {type(e)}")
                extracted_data = {}
                should_return_early = True

            if isinstance(extracted_data, dict) and extracted_data:
                await _process_transaction_sync(
                    extracted_data,
                    sender_id,
                    detected_language,
                    current_date,
                    original_transcription,
                    english_translation
                )
            else:
                await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])
                should_return_early = True
        else:
            await send_whatsapp_message(sender_id, MESSAGES[detected_language]["transcribe_fail"])
            should_return_early = True

    print("DEBUG_APP: whatsapp_webhook function completing.")
    return str(MessagingResponse())

async def _translate_text_to_target_language(text: str, target_language: str) -> str:
    try:
        prompt = f"""Translate the following text into {target_language}. Respond only with the translated text.
Text: {text}"""
        response = client.chat.completions.create(
            model="gpt-3.5-turbo-0125",
            messages=[
                {"role": "system", "content": "You are a helpful assistant that translates text."},
                {"role": "user", "content": prompt}
            ],
            temperature=0.0
        )
        translated_text = response.choices[0].message.content.strip()
        print(f"DEBUG_TRANSLATION: Original: '{text}', Translated to {target_language}: '{translated_text}'")
        return translated_text
    except Exception as e:
        print(f"ERROR_TRANSLATION: Error translating text: {e}")
        return text

async def _process_transaction_sync(extracted_data: dict, sender_id: str, detected_language: str, current_date: date, original_transcription: str, english_translation: str):
    print(f"DEBUG_APP: Entering synchronous transaction processing block with data: {extracted_data}")
    transaction_type = extracted_data.get("type", "").lower()
    print(f"DEBUG: Identified transaction type: {transaction_type}")

    profit_keywords = ["profit", "‡§Æ‡•Å‡§®‡§æ‡§´‡§æ", "labh", "‡§´‡§æ‡§Øda", "profitability", "‡§≤‡§æ‡§≠"]
    should_show_profit = any(keyword in original_transcription.lower() for keyword in profit_keywords) or \
                         any(keyword in english_translation.lower() for keyword in profit_keywords)

    if transaction_type == "sale":
        sales_summary_messages = []
        unprocessed_items_messages = []
        total_sales_amount = 0.0
        total_profit = 0.0

        items_sold = extracted_data.get("items_sold", [])
        if items_sold:
            stock_levels = await get_stock_levels(sender_id)
            stock_map = {f"{item['item_name']}-{item['unit']}": item for item in stock_levels}
            print(f"DEBUG_STOCK: Current stock_levels: {stock_levels}")
            print(f"DEBUG_STOCK: Current stock_map keys: {list(stock_map.keys())}")

            target_stock_language = "hi"

            for item in items_sold:
                item_name = item.get("item_name")
                quantity = item.get("quantity")
                unit = item.get("unit", "pcs")
                selling_amount = item.get("selling_amount")

                print(f"DEBUG_ITEM_PROCESSING: Processing extracted item: {{'item_name': '{item_name}', 'quantity': {quantity}, 'unit': '{unit}', 'selling_amount': {selling_amount}}}")

                if item_name and isinstance(quantity, (int, float)) and isinstance(selling_amount, (int, float)):
                    stock_item_name_for_lookup = item_name

                    contains_latin = bool(re.search(r'[a-zA-Z]', item_name))

                    if contains_latin and target_stock_language == "hi":
                        translated_item_name = await _translate_text_to_target_language(item_name, target_stock_language)
                        stock_item_name_for_lookup = translated_item_name
                        print(f"DEBUG: Extracted item name '{item_name}' contains Latin characters and target stock language is Hindi. Translated to '{translated_item_name}' for stock lookup.")
                    elif detected_language != target_stock_language:
                        translated_item_name = await _translate_text_to_target_language(item_name, target_stock_language)
                        stock_item_name_for_lookup = translated_item_name
                        print(f"DEBUG: Incoming item '{item_name}' (detected_lang={detected_language}) translated to '{translated_item_name}' (target_lang={target_stock_language}) for stock lookup.")
                    else:
                        print(f"DEBUG: Incoming item '{item_name}' (detected_lang={detected_language}) is already in target stock language ({target_stock_language}) or no translation needed. No translation performed.")

                    best_match_item_name = None
                    best_match_score = 0.0

                    print(f"DEBUG_FUZZY: Starting fuzzy match for '{stock_item_name_for_lookup}'")
                    for stock_item_obj in stock_levels:
                        item_name_in_stock = stock_item_obj['item_name']
                        current_score = max(fuzz.token_sort_ratio(stock_item_name_for_lookup.lower(), item_name_in_stock.lower()),
                                            fuzz.partial_ratio(stock_item_name_for_lookup.lower(), item_name_in_stock.lower()))
                        print(f"DEBUG_FUZZY: Comparing '{stock_item_name_for_lookup}' with stock item '{item_name_in_stock}'. Score: {current_score}")

                        if current_score > best_match_score:
                            best_match_score = current_score
                            best_match_item_name = item_name_in_stock

                    print(f"DEBUG_FUZZY: Best fuzzy match for '{stock_item_name_for_lookup}': '{best_match_item_name}' with score {best_match_score}")

                    if best_match_item_name and best_match_score >= 40:
                        original_lookup_name_before_fuzzy = stock_item_name_for_lookup
                        stock_item_name_for_lookup = best_match_item_name
                        print(f"DEBUG_FUZZY: Fuzzy match successful. Using '{stock_item_name_for_lookup}' (originally '{original_lookup_name_before_fuzzy}') for stock lookup.")
                    else:
                        print(f"DEBUG_FUZZY: No strong fuzzy match found for '{stock_item_name_for_lookup}' (score: {best_match_score}). Proceeding with original lookup name.")
                        pass

                    print(f"DEBUG_ITEM_MATCH: Attempting to find final stock item for '{stock_item_name_for_lookup}' with effective unit '{unit}'")
                    stock_key = f"{stock_item_name_for_lookup}-{unit}"

                    final_stock_item = None
                    if stock_key in stock_map:
                        final_stock_item = stock_map[stock_key]
                        print(f"DEBUG_ITEM_MATCH: Found exact match in stock_map for key: '{stock_key}'. Item: {final_stock_item}")
                    else:
                        print(f"DEBUG_ITEM_MATCH: No exact match in stock_map for key: '{stock_key}'. Attempting fuzzy unit match.")
                        for existing_stock_key, existing_stock_item in stock_map.items():
                            if fuzz.token_sort_ratio(stock_item_name_for_lookup.lower(), existing_stock_item['item_name'].lower()) >= 80:
                                final_stock_item = existing_stock_item
                                stock_key = existing_stock_key
                                unit = existing_stock_item['unit']
                                print(f"DEBUG_ITEM_MATCH: Found fuzzy item name match with stock item '{existing_stock_item['item_name']}' (unit: '{existing_stock_item['unit']}'). Using this item.")
                                break

                    print(f"DEBUG_FINAL_ITEM_CHECK: final_stock_item before not found check: {final_stock_item}")

                    if not final_stock_item:
                        debug_info = f"Original extracted: {item_name}"
                        if detected_language != target_stock_language:
                            debug_info += f", Translated (if applicable): {original_lookup_name_before_fuzzy if 'original_lookup_name_before_fuzzy' in locals() else item_name}"
                        if best_match_item_name:
                            debug_info += f", Fuzzy matched (if applicable): {best_match_item_name}"
                        debug_info += f", Unit: {unit}"
                        unprocessed_items_messages.append(f"'{item_name}' is not in stock. ({debug_info}). Sale not recorded.")
                        continue

                    if final_stock_item and 'unit' in final_stock_item:
                        unit = final_stock_item['unit']
                        print(f"DEBUG_UNIT: Final effective unit for transaction '{item_name}': '{unit}'. (Original extracted unit: '{item.get('unit', 'pcs')}')")


                    delta_for_update = -float(quantity)

                    await update_stock_item(sender_id, stock_item_name_for_lookup, delta_for_update, unit, None)

                    sale_data = {
                        "date": extracted_data.get("date", current_date.strftime('%Y-%m-%d')),
                        "type": "sale",
                        "amount": selling_amount,
                        "item": f"{stock_item_name_for_lookup} ({quantity} {item.get('unit', 'pcs')})"
                    }
                    await save_transaction(sale_data, sender_id)

                    total_sales_amount += selling_amount

                    cost_price_per_unit = None
                    if final_stock_item.get("cost_price_per_unit") is not None:
                        cost_price_per_unit = float(final_stock_item["cost_price_per_unit"])

                    profit_for_item = 0.0
                    if cost_price_per_unit is not None:
                        profit_for_item = selling_amount - (float(quantity) * cost_price_per_unit)
                        total_profit += profit_for_item

                    if should_show_profit and cost_price_per_unit is not None:
                        sales_summary_messages.append(f"{final_stock_item['item_name']}: ‚Çπ{selling_amount:.2f} (Profit: ‚Çπ{profit_for_item:.2f})")
                    else:
                        sales_summary_messages.append(f"{final_stock_item['item_name']}: ‚Çπ{selling_amount:.2f}")

            print(f"DEBUG_REPLY: sales_summary_messages: {sales_summary_messages}")
            print(f"DEBUG_REPLY: unprocessed_items_messages: {unprocessed_items_messages}")

            final_reply_parts = []
            if sales_summary_messages:
                success_item_summary = "\n".join(sales_summary_messages)
                item_details = f"Total Profit: ‚Çπ{total_profit:.2f}\n{success_item_summary}" if should_show_profit and total_profit > 0 else success_item_summary
                success_message = MESSAGES[detected_language]["sale_success"].format(amount=total_sales_amount, item_details=item_details)
                final_reply_parts.append(success_message)

            if unprocessed_items_messages:
                error_message = "‚ùå Some items were not processed:\n" + "\n".join(unprocessed_items_messages)
                final_reply_parts.append(error_message)

            print(f"DEBUG_REPLY: final_reply_parts before join: {final_reply_parts}")
            if final_reply_parts:
                reply_message = "\n\n".join(final_reply_parts)
                await send_whatsapp_message(sender_id, reply_message)
            else:
                await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])
        else:
            await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])

    elif transaction_type == "purchase":
        purchase_summary_messages = []
        total_purchase_expense = 0.0

        items_purchased = extracted_data.get("items_purchased", [])
        if items_purchased:
            for item in items_purchased:
                item_name = item.get("item_name")
                quantity = item.get("quantity")
                unit = item.get("unit", "pcs")
                cost_price_per_unit = item.get("cost_price_per_unit")

                if item_name and isinstance(quantity, (int, float)) and cost_price_per_unit is not None:
                    await update_stock_item(sender_id, item_name, float(quantity), unit, cost_price_per_unit)
                    purchase_summary_messages.append(f"{item_name}: {quantity} {unit} @ ‚Çπ{cost_price_per_unit:.2f}/{unit}")

                    total_purchase_expense += float(quantity) * float(cost_price_per_unit)

            if purchase_summary_messages:
                if total_purchase_expense > 0:
                    expense_data = {
                        "date": extracted_data.get("date", current_date.strftime('%Y-%m-%d')),
                        "type": "expense",
                        "amount": total_purchase_expense,
                        "item": f"Stock purchase ({len(purchase_summary_messages)} items)"
                    }
                    await save_transaction(expense_data, sender_id)
                    purchase_summary_messages.append(f"Total expense of ‚Çπ{total_purchase_expense:.2f} recorded.")

                reply_message = MESSAGES[detected_language]["stock_update_success"].format(updates="\n".join(purchase_summary_messages))
                await send_whatsapp_message(sender_id, reply_message)
            else:
                await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])
        else:
            await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])

    elif transaction_type == "expense":
        amount = extracted_data.get("amount")
        description = extracted_data.get("description", "")
        if isinstance(amount, (int, float)):
            expense_data = {
                "date": extracted_data.get("date", current_date.strftime('%Y-%m-%d')), "type": "expense",
                "amount": amount, "item": description
            }
            await save_transaction(expense_data, sender_id)

            if description:
                reply_message = MESSAGES[detected_language]["expense_success"].format(amount=amount, item=description)
            else:
                reply_message = MESSAGES[detected_language]["expense_success_no_item"].format(amount=amount)
            await send_whatsapp_message(sender_id, reply_message)
        else:
            await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])

    elif transaction_type == "order_confirmation":
        # CORRECTED: This block now handles a list of items for a single supplier.
        items_to_order = extracted_data.get("items_to_order", [])
        supplier_name = extracted_data.get("supplier_name")

        if items_to_order and supplier_name:
            print(f"DEBUG_ORDER_CONFIRMATION: Received order confirmation for {len(items_to_order)} items from {supplier_name}.")
            
            supplier_phone_number = None
            for sup_name, sup_info in SUPPLIERS.items():
                if fuzz.ratio(supplier_name.lower(), sup_name.lower()) >= 80:
                    supplier_phone_number = sup_info["phone"]
                    break

            if supplier_phone_number:
                # Format the list of items into a single string for the call agent
                order_details_list = [f"{item.get('quantity', 0)} {item.get('unit', 'pcs')} {item.get('item_name', '')}" for item in items_to_order]
                order_details_str = ", ".join(order_details_list)
                
                from call_handler import initiate_outbound_call
                call_initiated = await initiate_outbound_call(
                    to_number=supplier_phone_number,
                    order_details=order_details_str, # Pass the full order string
                    supplier_name=supplier_name,
                    user_id=sender_id
                )

                if call_initiated:
                    reply_message = f"Calling {supplier_name} to place the following order:\n- {', '.join(order_details_list)}"
                    await send_whatsapp_message(sender_id, reply_message)
                else:
                    reply_message = MESSAGES[detected_language]["order_failed_shopkeeper"].format(
                        item_name=f"{len(items_to_order)} items",
                        supplier_name=supplier_name,
                        reason="Failed to initiate call."
                    )
                    await send_whatsapp_message(sender_id, reply_message)
            else:
                await send_whatsapp_message(sender_id, f"Supplier '{supplier_name}' not found.")
        else:
            await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])
    else:
        await send_whatsapp_message(sender_id, MESSAGES[detected_language]["extract_fail"])

# Dictionary to store call states (e.g., conversation history, order details)
# In a production environment, this would be stored in a database.
# Removed global call_states
# Removed call_states = None



async def transcribe_speech_from_url(audio_url: str) -> str:
    """Transcribes speech from an audio URL using OpenAI's Whisper API."""
    try:
        temp_audio_path = f"./temp_call_audio_{os.urandom(4).hex()}.wav"
        print(f"DEBUG_WHISPER: Downloading audio from {audio_url} to {temp_audio_path}")
        response = requests.get(audio_url, stream=True)
        response.raise_for_status()
        with open(temp_audio_path, 'wb') as f:
            for chunk in response.iter_content(chunk_size=8192):
                f.write(chunk)
        print(f"DEBUG_WHISPER: Downloaded audio to {temp_audio_path}")

        with open(temp_audio_path, "rb") as audio_file:
            transcription = await asyncio.to_thread(
                client.audio.transcriptions.create,
                model="whisper-1",
                file=audio_file
            )
        os.remove(temp_audio_path)
        print(f"DEBUG_WHISPER: Transcription result: {transcription.text}")
        return transcription.text
    except Exception as e:
        print(f"ERROR_WHISPER: Failed to transcribe speech from {audio_url}: {e}")
        return ""

async def get_openai_response(conversation_history: list, temperature: float = 0.5, max_tokens: int = 150) -> str:
    """Gets a response from OpenAI's GPT model."""
    try:
        response = await asyncio.to_thread(
            client.chat.completions.create,
            model="gpt-3.5-turbo",
            messages=conversation_history,
            temperature=temperature,
            max_tokens=max_tokens
        )
        return response.choices[0].message.content
    except Exception as e:
        print(f"ERROR_OPENAI_RESPONSE: Failed to get OpenAI response: {e}")
        return "I'm sorry, I'm having trouble understanding right now. Please try again."

@app.route("/audio/<filename>")
def serve_audio(filename):
    print(f"DEBUG: Serving audio file: {filename}")
    try:
        return send_from_directory('audio', filename)
    except Exception as e:
        print(f"ERROR: Failed to serve audio file {filename}: {str(e)}")
        return ("Audio file not found", 404)

@app.route("/omnidim_post_call_webhook", methods=['POST'])
async def omnidim_post_call_webhook():
    try:
        payload = request.get_json()
        print("DEBUG_OMNIDIM_WEBHOOK: Received post-call webhook from OmniDimension.")
        print(f"DEBUG_OMNIDIM_WEBHOOK: Payload: {json.dumps(payload, indent=2)}")

        # Here you can process the payload as needed.
        # For example, you can save the call summary, conversation, or extracted data to your database.
        # The 'payload' dictionary will contain:
        # - 'callSummary': A brief overview of the call.
        # - 'fullConversation': The complete transcript with timestamps.
        # - 'sentimentAnalysis': Analysis of customer mood.
        # - 'extractedInformation': Key data points you configured for extraction.

        # Example: Accessing parts of the payload
        call_summary = payload.get("callSummary")
        full_conversation = payload.get("fullConversation")
        extracted_info = payload.get("extractedInformation")

        if call_summary:
            print(f"Call Summary: {call_summary}")
        if full_conversation:
            print(f"Full Conversation Length: {len(full_conversation)} characters")
        if extracted_info:
            print(f"Extracted Information: {extracted_info}")

        # You might want to get the original metadata from the call dispatch
        # This would typically be passed back in the webhook payload or via a call ID lookup
        # For now, we'll just acknowledge the receipt.

        return {"status": "success", "message": "Post-call data received"}, 200
    except Exception as e:
        print(f"ERROR_OMNIDIM_WEBHOOK: Error processing OmniDimension post-call webhook: {str(e)}")
        return {"status": "error", "message": str(e)}, 500

# Function to run the scheduler in its own event loop
def _run_scheduler():
    loop = asyncio.new_event_loop()
    asyncio.set_event_loop(loop)
    loop.call_soon_threadsafe(scheduler.start)
    loop.run_forever()

# Shut down the scheduler when the Flask app stops
@app.teardown_appcontext
def shutdown_scheduler(exception=None):
    if scheduler.running:
        scheduler.shutdown()
        print("Scheduler for low stock alerts has been shut down.")

async def generate_local_insights():
    """
    Generates detailed, actionable insights for shopkeepers by combining 14-day weather forecasts,
    upcoming festivals, and current inventory levels into a single, efficient LLM call.
    """
    if os.environ.get('DISABLE_INSIGHTS_ALERTS') == 'true':
        print("DEBUG_INSIGHTS: Alerts and insights generation is disabled.")
        return
    
    print("DEBUG_INSIGHTS: Generating local insights...")
    unique_user_ids = await get_all_unique_user_ids_with_stock()

    # --- Step 1: Fetch Global Data Once ---
    latitude = SHOPKEEPER_LOCATION["latitude"]
    longitude = SHOPKEEPER_LOCATION["longitude"]
    weather_data = await get_weather_forecast(latitude, longitude)
    festivals_data = get_festivals_from_llm(days_in_advance=90)

    # --- Step 2: Process All Insights For Each User ---
    for user_id in unique_user_ids:
        print(f"DEBUG_INSIGHTS: Generating insights for user: {user_id}")
        
        stock_levels = await get_stock_levels(user_id)
        stock_list_str = ", ".join([item['item_name'].lower() for item in stock_levels]) if stock_levels else "‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§"

        # --- Step 3: Create a Hindi-focused, Concise, and Structured Prompt ---
        weather_summary = "‡§Æ‡•å‡§∏‡§Æ ‡§ï‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§Ö‡§≠‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§"
        if weather_data and "daily" in weather_data:
            daily = weather_data['daily']
            weather_summary = (
                f"‡§Ö‡§ó‡§≤‡•á 14 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®:\n"
                f"- ‡§§‡§æ‡§™‡§Æ‡§æ‡§®: ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ {min(daily['temperature_2m_min'])}¬∞C ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ {max(daily['temperature_2m_max'])}¬∞C ‡§§‡§ï‡•§"
            )

        festival_summary = "‡§Ö‡§ó‡§≤‡•á 90 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§¨‡§°‡§º‡•á ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§"
        if festivals_data:
            festival_list = [f"{f['name']} ({f['date']})" for f in festivals_data]
            festival_summary = "‡§Ü‡§ó‡§æ‡§Æ‡•Ä ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞: " + ", ".join(festival_list)

        # CORRECTED: The prompt is now much stricter and demands separate JSON keys.
        master_prompt = f"""
        You are a Retail Expert for Indian kirana stores. Your goal is to provide actionable advice in HINDI.

        **Data Provided:**
        1.  **14-Day Weather Forecast:** {weather_summary}
        2.  **Upcoming Festivals:** {festival_summary}
        3.  **Current Inventory:** {stock_list_str}

        **Your Tasks (in Hindi):**
        1.  **Opportunities:** Identify 2 key sales opportunities, one for weather and one for festivals.
        2.  **Recommendations:** Provide two separate lists of recommendations:
            - A list named `weather_recommendations` with 2 products based ONLY on the weather.
            - A list named `festival_recommendations` with 2-3 products based ONLY on the festivals.
        
        **Output Format:**
        Respond ONLY with a valid JSON object. The root object MUST have three keys: "opportunities", "weather_recommendations", and "festival_recommendations".
        All string values MUST BE IN HINDI, except for "potential" and "action".

        Example:
        {{
          "opportunities": [
            "‡§¨‡§¢‡§º‡§§‡•Ä ‡§ó‡§∞‡•ç‡§Æ‡•Ä ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§†‡§Ç‡§°‡•á ‡§™‡•á‡§Ø ‡§™‡§¶‡§æ‡§∞‡•ç‡§•‡•ã‡§Ç ‡§ï‡•Ä ‡§Æ‡§æ‡§Ç‡§ó ‡§¨‡§¢‡§º‡•á‡§ó‡•Ä‡•§",
            "‡§¶‡§ø‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§Æ‡§ø‡§†‡§æ‡§à ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•Ä ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•Ä ‡§≠‡§æ‡§∞‡•Ä ‡§Æ‡§æ‡§Ç‡§ó‡•§"
          ],
          "weather_recommendations": [
            {{
              "action": "Procure",
              "item": "‡§®‡•Ä‡§Ç‡§¨‡•Ç ‡§™‡§æ‡§®‡•Ä ‡§Æ‡§ø‡§ï‡•ç‡§∏",
              "reason": "‡§ó‡§∞‡•ç‡§Æ‡•Ä ‡§ï‡•á ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∞‡§æ‡§π‡§§ ‡§ï‡•á ‡§≤‡§ø‡§è‡•§",
              "potential": "High"
            }}
          ],
          "festival_recommendations": [
            {{
              "action": "Promote",
              "item": "‡§ò‡•Ä ‡§î‡§∞ ‡§¨‡•á‡§∏‡§®",
              "reason": "‡§¶‡§ø‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•Ä ‡§Æ‡§ø‡§†‡§æ‡§á‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡•§",
              "potential": "High"
            }}
          ]
        }}
        """

        try:
            # --- Step 4: Make One Efficient LLM Call for Insights ---
            response = await asyncio.to_thread(
                client.chat.completions.create,
                model="gpt-4o-mini",
                messages=[
                    {"role": "system", "content": "You are an expert for Indian grocery stores. You MUST reply with a valid JSON object where all string values are in Hindi, except for 'action' and 'potential'."},
                    {"role": "user", "content": master_prompt}
                ],
                response_format={"type": "json_object"},
                temperature=0.5,
            )
            
            insights_json = json.loads(response.choices[0].message.content)
            opportunities = insights_json.get("opportunities", [])
            # CORRECTED: Get both lists from the new JSON structure
            weather_recs = insights_json.get("weather_recommendations", [])
            festival_recs = insights_json.get("festival_recommendations", [])
            
            # --- Step 5: Format the Insightful Response for WhatsApp ---
            final_message_parts = []
            if opportunities:
                final_message_parts.append("üìà **‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§ï‡•á ‡§Ö‡§µ‡§∏‡§∞**")
                for opp in opportunities:
                    final_message_parts.append(f"‚Ä¢ {opp}")

            # CORRECTED: Separate loops for weather and festival recommendations
            if weather_recs:
                final_message_parts.append("\nüå¶Ô∏è **‡§Æ‡•å‡§∏‡§Æ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç**")
                for rec in weather_recs:
                    action_text = "üü¢ ‡§™‡•ç‡§∞‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç" if rec.get('action') == 'Promote' else "üì¶ ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç"
                    item = rec.get("item", "N/A")
                    potential = rec.get("potential", "N/A")
                    reason = rec.get("reason", "N/A")
                    final_message_parts.append(f"‚Ä¢ **{action_text}: {item}** (‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ: {potential})\n  - *‡§ï‡§æ‡§∞‡§£: {reason}*")

            if festival_recs:
                final_message_parts.append("\nüéâ **‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç**")
                for rec in festival_recs:
                    action_text = "üü¢ ‡§™‡•ç‡§∞‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç" if rec.get('action') == 'Promote' else "üì¶ ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç"
                    item = rec.get("item", "N/A")
                    potential = rec.get("potential", "N/A")
                    reason = rec.get("reason", "N/A")
                    final_message_parts.append(f"‚Ä¢ **{action_text}: {item}** (‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ: {potential})\n  - *‡§ï‡§æ‡§∞‡§£: {reason}*")
            
            # --- Step 6: Add Low-Stock Alert to the Same Message ---
            low_stock_items = await get_low_stock_items(user_id)
            if low_stock_items:
                final_message_parts.append("\n‚ö†Ô∏è **‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ï‡•Ä ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä!**")
                for item in low_stock_items:
                    item_name = item.get('item_name', 'N/A')
                    quantity = item.get('quantity', 0)
                    unit = item.get('unit', '')
                    final_message_parts.append(f"‚Ä¢ **{item_name}**: ‡§ï‡•á‡§µ‡§≤ {quantity} {unit} ‡§¨‡§ö‡§æ ‡§π‡•à‡•§")
                final_message_parts.append("*‡§á‡§® ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•ã ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§*")

            # --- Step 7: Send the Final, Combined Message ---
            if final_message_parts:
                final_message_body = "\n".join(final_message_parts)
                await send_whatsapp_message(user_id, final_message_body)
            else:
                print(f"DEBUG_INSIGHTS: No actionable insights generated for {user_id}.")

        except Exception as e:
            print(f"ERROR_INSIGHTS: Failed to generate insights for user {user_id}: {e}")




if __name__ == "__main__":
    # This ensures the scheduler runs only once, even with Flask's reloader.
    if os.environ.get('WERKZEUG_RUN_MAIN') == 'true':
        # Initialize a Manager for shared state between processes
        manager = Manager()
        call_states = manager.dict() # Use Manager dictionary for process-safe state
        
    # Initialize and start the scheduler when the app starts
        if not scheduler.running:
            scheduler.add_job(generate_local_insights, 'interval', seconds=30, id='generate_insights_job', replace_existing=True)
        # Removed the low stock alert scheduler job
        # scheduler.add_job(check_low_stock_and_alert, 'interval', seconds=30, id='check_low_stock_and_alert', replace_existing=True)
        scheduler_thread = Thread(target=_run_scheduler)
        scheduler_thread.daemon = True
        scheduler_thread.start()
        print("Scheduler for local insights has been started in a separate thread.")

    # Run the Flask app
    # Using debug=True is helpful for development as it provides detailed errors
    # and automatically reloads the server when you make code changes.
    # Make sure to set debug=False for a production environment.
    app.run(debug=True, host="0.0.0.0", port=5000)